---
title: "Paper Plots V2"
author: "Brett Stacy"
date: "2024-11-25"
output: pdf_document
editor_options: 
  chunk_output_type: console
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, warning = F, message = F, results = "hide", fig.width = 8.5, fig.height = 5, dpi = 600)
library(tidytable)
library(data.table)
library(reshape2)
library(ggplot2)
library(knitr)
library(stringr)
library(patchwork)
opts_knit$set(eval.after = "fig.cap")
options(scipen = 5)
```


# Introduction
Plots for paper:



## Data
```{r}


out_1.4 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_1.4_ISS_1000iters_output_2025-01-23.RDS")

out_3.2 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_1.4_ISS_500iters_output_2025-03-06.RDS") ### mislabeled

out_5.2 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_5.2_ISS_500iters_output_2025-01-27.RDS")

out_9.2 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_9.2_ISS_500iters_output_2025-01-27.RDS")

out_4.2 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_4.2_ISS_500iters_output_2025-01-28.RDS")

out_2.2 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_2.2_ISS_500iters_output_2025-01-28.RDS")


# save out_1.4 for Steve to plug into the assessment
out_1.4$length$iss %>% 
  select(YEAR, iss) %>% 
  write.csv(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/Fishery ISS Paper/issb_v1_from_Brett_Stacy.csv", row.names = F)


assessment_2023_iss = tidytable(year = 1977:2023,
                                iss = c(27,
                                45,
                                54,
                                54,
                                63,
                                31,
                                117,
                                140,
                                211,
                                216,
                                396,
                                401,
                                185,
                                189,
                                1565,
                                1543,
                                913,
                                1435,
                                1561,
                                2020,
                                2142,
                                2046,
                                2722,
                                2960,
                                3140,
                                3446,
                                4301,
                                3608,
                                3455,
                                2694,
                                2115,
                                2502,
                                2218,
                                1975,
                                2596,
                                2776,
                                3293,
                                3604,
                                3324,
                                2821,
                                2469,
                                1899,
                                1367,
                                1048,
                                859,
                                1160,
                                706))




# survey vs observer length measurements
obs_numbers = tidytable(year = 1982:2023,
                        survey = c(10863,
                        13143,
                        12133,
                        17150,
                        15872,
                        9483,
                        6950,
                        4246,
                        5428,
                        7069,
                        10129,
                        10500,
                        12931,
                        9820,
                        9348,
                        9591,
                        9574,
                        11183,
                        12170,
                        19078,
                        12365,
                        11835,
                        10986,
                        11753,
                        12530,
                        13441,
                        15328,
                        23737,
                        21223,
                        25150,
                        30177,
                        19902,
                        29204,
                        19880,
                        19507,
                        15020,
                        8806,
                        23408,
                        0,
                        17397,
                        16677,
                        19943),
                        fishery = c(9658,
                                    33200,
                                    45635,
                                    66940,
                                    58257,
                                    129226,
                                    111065,
                                    58625,
                                    39698,
                                    347227,
                                    344923,
                                    248967,
                                    359147,
                                    344794,
                                    445217,
                                    474908,
                                    438746,
                                    186233,
                                    199708,
                                    210419,
                                    230802,
                                    288854,
                                    237487,
                                    228664,
                                    179782,
                                    140663,
                                    164860,
                                    147875,
                                    131514,
                                    172269,
                                    192273,
                                    211962,
                                    234476,
                                    213888,
                                    182980,
                                    157482,
                                    124004,
                                    86800,
                                    65301,
                                    55858,
                                    73025,
                                    42942))


obs_numbers %>% 
  tidytable::summarise(sum(survey), sum(fishery))




```


## ISSB Results 
### * Time series 2 panel 

```{r, fig.height=6}
df = data.frame(rss = out_1.4$length$rss$rss, year = as.factor(out_1.4$length$rss$YEAR))



# par(mfrow = c(4,1), mar = c(0,0,0,0), oma = c(2, 4, 2, .5), mgp = c(2, .6, 0))
# par(mfrow = c(3,1), mar = c(1.5, 3.1, 0, .5), mgp = c(2, .6, 0))
par(mfrow = c(2,1), mar = c(0,3.1,0,0), oma = c(2, 0, 2, .5), mgp = c(2, .6, 0))
plot(out_1.4$length$iss$YEAR, out_1.4$length$iss$iss, type = "l", ylab = "ISS", xaxt = "n", ylim = c(0, 15000), cex.lab = 1.3) 
lines(assessment_2023_iss$year, assessment_2023_iss$iss, col = "blue")
lines(out_1.4$length$iss$YEAR, out_1.4$length$iss$nhls, col = "red")
lines(out_3.2$length$iss$YEAR, out_3.2$length$iss$iss, col = "green")
legend(1977, 11000, lty = c(1,1,1,1), col = c("black", "blue", "red", "green"), legend = c("ISSB", "ISSA", "number of hauls", "ISSB-noSS"), bty = "n")
text(1977, 14000, "A")



plot(out_1.4$length$iss$YEAR, out_1.4$length$iss$nss, type = "l", ylab = "Nominal Sample Size", xlab = "Year", cex.lab = 1.3) 
text(1977, 420000, "B")



# averages
out_1.4$length$iss$iss %>% mean()
assessment_2023_iss$iss %>% mean()


```




\newpage

### * 2003 and 2004 histograms
```{r, fig.height=8, fig.width=9}


out_1.4$length$og_props %>% 
  tidytable::filter(YEAR %in% 2003:2004) %>% 
  tidytable::mutate(Year = as.factor(YEAR)) -> props.sub

p1 = ggplot(data = props.sub, aes(x = LENGTH, y = og_FREQ, colour = Year)) +
  geom_line() +
  geom_area(aes(fill = Year, group = Year), alpha = 0.5, position = "identity") +
  theme_classic() +
  scale_x_continuous(limits = c(22, 108),
                     n.breaks = 9) +
  labs(x = "Length (cm)", y = "Frequency", tag = "A") +
  theme(legend.position = c(0.8, 0.8),
        plot.tag.position = c(0.1, 0.95),
        plot.tag = element_text(size = 14, face = "bold")) +
  scale_y_continuous(limits = c(0, .04), expand = c(0, 0))



# now do RSS
out_1.4$length$rss %>% 
  tidytable::filter(YEAR %in% 2003:2004) %>% 
  tidytable::mutate(Year = as.factor(YEAR)) -> props.sub

p3 = ggplot(data = props.sub, aes(x = rss, colour = Year)) +
  geom_histogram(aes(fill = Year, group = Year), alpha = 0.5, position = "identity") +
  theme_classic() +
  theme(legend.position = c(0.8, 0.8),
        plot.tag.position = c(0.1, 0.95),
        plot.tag = element_text(size = 14, face = "bold")) +
  labs(x = "RSS", y = "Count", tag = "B") + 
  geom_point(data = props.sub %>% 
               tidytable::left_join(out_1.4$length$iss %>% 
                                      tidytable::select(YEAR, iss)) %>% 
               tidytable::summarise(x = unique(iss), .by = Year) %>% 
               # tidytable::summarise(x = median(rss), .by = Year) %>% 
               tidytable::mutate(y = c(9,9)), aes(x,y, fill = Year), shape = 25, size = 4, color = "black") +
  scale_y_continuous(limits = c(0, 300), expand = c(0, 0)) +
  # scale_x_continuous(n.breaks = 8)
  scale_x_continuous(breaks = seq(0, 35000, by = 2500),
                     labels = c(0, "", 5000, "", 10000, "", 15000, "", 20000, "", 25000, "", 30000, "", 35000))


p1 / p3



```

The comparison shows that fish in 2003 were less similar in length compared to 2004. 2003 corresponds to a higher ISS even though the sample rate was the same and the number of hauls and nominal sample size were comparable. More of the fish sampled in 2003 were required for characterizing the underlying multinomial sampling distribution compared to 2004 because more lengths were represented at a higher rate in 2003 (shorter, wider distribution). This is reflected in the RSS (ref figure).


### * Time seris components

\newpage

```{r, fig.height=5.5}
sub_range = out_5.2$length$iss$YEAR %in% 1977:2023

par(mfrow = c(1,1))
plot(out_5.2$length$iss$YEAR[sub_range], out_5.2$length$iss$iss[sub_range], type = "l", ylab = "ISSB", cex.lab = 1.3, col = "black", ylim = c(0, 25000), xlab = "Year")
lines(out_9.2$length$iss$YEAR[sub_range], out_9.2$length$iss$iss[sub_range], type = "l", col = "blue") 
lines(out_4.2$length$iss$YEAR[sub_range], out_4.2$length$iss$iss[sub_range], type = "l", col = "orange") 
lines(out_2.2$length$iss$YEAR[sub_range], out_2.2$length$iss$iss[sub_range], type = "l", col = "green")
lines(out_1.4$length$iss$YEAR[sub_range], out_1.4$length$iss$iss[sub_range], type = "l", col = "red")



legend("topleft", legend = c("boot length", "boot length + haul", "boot all", "boot all + sampling strata weighting", "full"), lty = c(1,1,1,1,1), col = c("black", "blue", "orange", "green", "red"), bty = "n")




# not accounting for correlations exceed hauls?
sum((out_5.2$length$iss$iss[sub_range]-out_1.4$length$iss$nhls) < 0)


```

\newpage





## Optimize Sampling



### Min 20
```{r, fig.width=9, fig.height=5}

## min(20, #samples) port and haul 1999-2023
# with replacement
out_26.1 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_26.1_ISS_500iters_output_2025-02-27.RDS")


year = out_26.1$length$iss$YEAR

df = tidytable(year = year,
               iss.base = out_1.4$length$iss$iss,
               iss.20.min = out_26.1$length$iss$iss)

df %>% 
  tidytable::mutate(ISS.error = (iss.20.min - iss.base)/iss.base) %>% 
  filter(year%in%1999:2023) %>% 
  select(ISS.error) %>% 
  boxplot()



# without replacement - THIS HAS MUCH SMALLER PERCENT DIFFERENCE! So use this in paper. 
out_27.1 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_27.1_ISS_500iters_output_2025-02-28.RDS")


year = out_27.1$length$iss$YEAR

df = tidytable(year = year,
               iss.base = out_1.4$length$iss$iss,
               iss.20.min = out_27.1$length$iss$iss)

df %>% 
  tidytable::mutate(ISS.error = (iss.20.min - iss.base)/iss.base) %>% 
  filter(year%in%1999:2023) %>% 
  select(ISS.error) %>% 
  boxplot()



# without replacement - Hauls only 
out_28.1 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_28.1_ISS_500iters_output_2025-02-28.RDS")


year = out_28.1$length$iss$YEAR

df = tidytable(year = year,
               iss.base = out_1.4$length$iss$iss,
               iss.20.min = out_28.1$length$iss$iss)

df %>% 
  tidytable::mutate(ISS.error = (iss.20.min - iss.base)/iss.base) %>% 
  filter(year%in%1999:2023) %>% 
  select(ISS.error) %>% 
  boxplot()





# df2 = melt.data.table(df, id.vars = "year", variable.name = "scenario", value.name = "ISS")






```



















### * Time series Expansion X Samples 10, 20, 30
```{r, fig.width=9, fig.height=5}
out_2.1.1 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_2.1.2_ISS_500_iters_2025-01-28.RDS")



year = out_2.1.1$samples_10$expansion_NULL$length$iss$YEAR




df = tidytable(year = year,
               N10_Enone = out_2.1.1$samples_10$expansion_NULL$length$iss$iss,
               N20_Enone = out_2.1.1$samples_20$expansion_NULL$length$iss$iss,
               N30_Enone = out_2.1.1$samples_30$expansion_NULL$length$iss$iss,
               N10_Emedium = out_2.1.1$samples_10$expansion_haul_numbers$length$iss$iss,
               N20_Emedium = out_2.1.1$samples_20$expansion_haul_numbers$length$iss$iss,
               N30_Emedium = out_2.1.1$samples_30$expansion_haul_numbers$length$iss$iss,
               N10_Efull = out_2.1.1$samples_10$expansion_haul_month_numbers$length$iss$iss,
               N20_Efull = out_2.1.1$samples_20$expansion_haul_month_numbers$length$iss$iss,
               N30_Efull = out_2.1.1$samples_30$expansion_haul_month_numbers$length$iss$iss,) 

df2 = melt.data.table(df, id.vars = "year", variable.name = "scenario", value.name = "ISS")



ggplot(data = df2, aes(x = year, y = ISS, group = scenario, colour = scenario)) +
  geom_line() +
  labs(x = "", y = "ISSB") +
  geom_point() + 
  theme_classic() +
  theme(legend.position = c(0.84, 0.8),
        axis.title.x = element_blank())
```



### * Time series Expansion NEW
```{r, fig.width=9, fig.height=5}
out_2.1.1 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_30.1_ISS_500_iters_2025-03-01.RDS")



year = out_2.1.1$expansion_NULL$length$iss$YEAR




df = tidytable(year = year,
               none = out_2.1.1$expansion_NULL$length$iss$iss,
               medium = out_2.1.1$expansion_haul_numbers$length$iss$iss,
               full = out_2.1.1$expansion_haul_month_numbers$length$iss$iss) 

df2 = melt.data.table(df, id.vars = "year", variable.name = "scenario", value.name = "ISS")


# all years
ggplot(data = df2, aes(x = year, y = ISS, group = scenario, colour = scenario)) +
  geom_line() +
  labs(x = "", y = "ISSB") +
  geom_point() + 
  theme_classic() +
  theme(legend.position = c(0.84, 0.8),
        axis.title.x = element_blank())

# 1999:2023
df2 %>% 
  filter(year%in%1999:2023) -> df2
ggplot(data = df2, aes(x = year, y = ISS, group = scenario, colour = scenario)) +
  geom_line() +
  labs(x = "", y = "ISSB") +
  geom_point() + 
  theme_classic() +
  theme(legend.position = c(0.84, 0.8),
        axis.title.x = element_blank())
```





### * Samples VS Expantion. Boxplots Together 1999-2023
```{r, fig.width=8}

out_22.1 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_22.2_ISS_500_iters_2025-02-01.RDS")

year = out_22.1$samples_1$expansion_NULL$length$iss$YEAR


df = tidytable(year = year,
               N1_Enone = out_22.1$samples_1$expansion_NULL$length$iss$iss,
               N5_Enone = out_22.1$samples_5$expansion_NULL$length$iss$iss,
               N10_Enone = out_22.1$samples_10$expansion_NULL$length$iss$iss,
               N15_Enone = out_22.1$samples_15$expansion_NULL$length$iss$iss,
               N20_Enone = out_22.1$samples_20$expansion_NULL$length$iss$iss,
               N25_Enone = out_22.1$samples_25$expansion_NULL$length$iss$iss,
               N30_Enone = out_22.1$samples_30$expansion_NULL$length$iss$iss,
               N35_Enone = out_22.1$samples_35$expansion_NULL$length$iss$iss,
               N1_Emedium = out_22.1$samples_1$expansion_haul_numbers$length$iss$iss,
               N5_Emedium = out_22.1$samples_5$expansion_haul_numbers$length$iss$iss,
               N10_Emedium = out_22.1$samples_10$expansion_haul_numbers$length$iss$iss,
               N15_Emedium = out_22.1$samples_15$expansion_haul_numbers$length$iss$iss,
               N20_Emedium = out_22.1$samples_20$expansion_haul_numbers$length$iss$iss,
               N25_Emedium = out_22.1$samples_25$expansion_haul_numbers$length$iss$iss,
               N30_Emedium = out_22.1$samples_30$expansion_haul_numbers$length$iss$iss,
               N35_Emedium = out_22.1$samples_35$expansion_haul_numbers$length$iss$iss,
               N1_Efull = out_22.1$samples_1$expansion_haul_month_numbers$length$iss$iss,
               N5_Efull = out_22.1$samples_5$expansion_haul_month_numbers$length$iss$iss,
               N10_Efull = out_22.1$samples_10$expansion_haul_month_numbers$length$iss$iss,
               N15_Efull = out_22.1$samples_15$expansion_haul_month_numbers$length$iss$iss,
               N20_Efull = out_22.1$samples_20$expansion_haul_month_numbers$length$iss$iss,
               N25_Efull = out_22.1$samples_25$expansion_haul_month_numbers$length$iss$iss,
               N30_Efull = out_22.1$samples_30$expansion_haul_month_numbers$length$iss$iss,
               N35_Efull = out_22.1$samples_35$expansion_haul_month_numbers$length$iss$iss) 

df2 = melt.data.table(df, id.vars = "year", variable.name = "scenario", value.name = "ISS")

df2[grep("Enone", scenario)] %>% 
  tidytable::mutate(ISS.error = (ISS - df2$ISS[df2$scenario=="N20_Enone"])/df2$ISS[df2$scenario=="N20_Enone"],
                    type = "Enone",
                    .by = scenario) %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 1, end = -7)) -> df3.1

df2[grep("Emedium", scenario)] %>% 
  tidytable::mutate(ISS.error = (ISS - df2$ISS[df2$scenario=="N20_Emedium"])/df2$ISS[df2$scenario=="N20_Emedium"],
                    type = "Emedium",
                    .by = scenario) %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 1, end = -9)) -> df3.2

df2[grep("Efull", scenario)] %>% 
  tidytable::mutate(ISS.error = (ISS - df2$ISS[df2$scenario=="N20_Efull"])/df2$ISS[df2$scenario=="N20_Efull"],
                    type = "Efull",
                    .by = scenario) %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 1, end = -7)) -> df3.3

df3.1 %>% 
  tidytable::bind_rows(df3.2) %>% 
  tidytable::bind_rows(df3.3) %>% 
  tidytable::mutate(scenario = forcats::fct_inorder(scenario)) -> df4
df4 -> df4.0


df4 %>% 
  ggplot(aes(x = scenario, y = ISS.error*100)) +
  geom_boxplot(aes(fill = type)) +
  labs(x = "Samples per Haul", y = "ISSB % Difference") +
  theme_classic() +
  theme(legend.position = c(0.5, 0.2)) +
  geom_hline(yintercept = -10, linetype = "dashed", color = "black") +
  geom_hline(yintercept = 10, linetype = "dashed", color = "black") +
  scale_y_continuous(breaks = seq(-100, 120, by = 10)) +
  scale_x_discrete(labels = c("1", "5", "10", "15", "20", "25", "30", "35"))


# Stats
df4 %>% filter(type=="trip", scenario=="N_0.25") %>% pull(ISS.error) %>% median
df4 %>% filter(type=="trip", scenario=="N_2.00") %>% pull(ISS.error) %>% median
df4 %>% filter(type=="haul", scenario=="N_0.25") %>% pull(ISS.error) %>% median
df4 %>% filter(type=="haul", scenario=="N_2.00") %>% pull(ISS.error) %>% median


```






### DATA: Samples VS Haul 
```{r, fig.width=8}

out_24.1 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_24.3_ISS_500_iters_2025-02-11.RDS")

year = out_24.1$samples_1$trip_0.5$length$iss$YEAR


df = tidytable(year = year,
               N1_H0.5 = out_24.1$samples_1$trip_0.5$length$iss$iss,
               N5_H0.5 = out_24.1$samples_5$trip_0.5$length$iss$iss,
               N10_H0.5 = out_24.1$samples_10$trip_0.5$length$iss$iss,
               N15_H0.5 = out_24.1$samples_15$trip_0.5$length$iss$iss,
               N20_H0.5 = out_24.1$samples_20$trip_0.5$length$iss$iss,
               N25_H0.5 = out_24.1$samples_25$trip_0.5$length$iss$iss,
               N30_H0.5 = out_24.1$samples_30$trip_0.5$length$iss$iss,
               N35_H0.5 = out_24.1$samples_35$trip_0.5$length$iss$iss,
               N1_H0.75 = out_24.1$samples_1$trip_0.75$length$iss$iss,
               N5_H0.75 = out_24.1$samples_5$trip_0.75$length$iss$iss,
               N10_H0.75 = out_24.1$samples_10$trip_0.75$length$iss$iss,
               N15_H0.75 = out_24.1$samples_15$trip_0.75$length$iss$iss,
               N20_H0.75 = out_24.1$samples_20$trip_0.75$length$iss$iss,
               N25_H0.75 = out_24.1$samples_25$trip_0.75$length$iss$iss,
               N30_H0.75 = out_24.1$samples_30$trip_0.75$length$iss$iss,
               N35_H0.75 = out_24.1$samples_35$trip_0.75$length$iss$iss,
               N1_H1.0 = out_22.1$samples_1$expansion_haul_month_numbers$length$iss$iss,
               N5_H1.0 = out_22.1$samples_5$expansion_haul_month_numbers$length$iss$iss,
               N10_H1.0 = out_22.1$samples_10$expansion_haul_month_numbers$length$iss$iss,
               N15_H1.0 = out_22.1$samples_15$expansion_haul_month_numbers$length$iss$iss,
               N20_H1.0 = out_22.1$samples_20$expansion_haul_month_numbers$length$iss$iss,
               N25_H1.0 = out_22.1$samples_25$expansion_haul_month_numbers$length$iss$iss,
               N30_H1.0 = out_22.1$samples_30$expansion_haul_month_numbers$length$iss$iss,
               N35_H1.0 = out_22.1$samples_35$expansion_haul_month_numbers$length$iss$iss,
               N1_H1.25 = out_24.1$samples_1$trip_1.25$length$iss$iss,
               N5_H1.25 = out_24.1$samples_5$trip_1.25$length$iss$iss,
               N10_H1.25 = out_24.1$samples_10$trip_1.25$length$iss$iss,
               N15_H1.25 = out_24.1$samples_15$trip_1.25$length$iss$iss,
               N20_H1.25 = out_24.1$samples_20$trip_1.25$length$iss$iss,
               N25_H1.25 = out_24.1$samples_25$trip_1.25$length$iss$iss,
               N30_H1.25 = out_24.1$samples_30$trip_1.25$length$iss$iss,
               N35_H1.25 = out_24.1$samples_35$trip_1.25$length$iss$iss) 

df2 = melt.data.table(df, id.vars = "year", variable.name = "scenario", value.name = "ISS")

df2[grep("H0.5", scenario)] %>% 
  tidytable::mutate(ISS.error = (ISS - df2$ISS[df2$scenario=="N20_H1.0"])/df2$ISS[df2$scenario=="N20_H1.0"],
                    type = "0.5",
                    .by = scenario) %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 1, end = -6)) -> df3.01


df2[grep("H0.75", scenario)] %>% 
  tidytable::mutate(ISS.error = (ISS - df2$ISS[df2$scenario=="N20_H1.0"])/df2$ISS[df2$scenario=="N20_H1.0"],
                    type = "0.75",
                    .by = scenario) %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 1, end = -7)) -> df3.1

df2[grep("H1.0", scenario)] %>% 
  tidytable::mutate(ISS.error = (ISS - df2$ISS[df2$scenario=="N20_H1.0"])/df2$ISS[df2$scenario=="N20_H1.0"],
                    type = "1.0",
                    .by = scenario) %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 1, end = -6)) -> df3.2

df2[grep("H1.25", scenario)] %>% 
  tidytable::mutate(ISS.error = (ISS - df2$ISS[df2$scenario=="N20_H1.0"])/df2$ISS[df2$scenario=="N20_H1.0"],
                    type = "1.25",
                    .by = scenario) %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 1, end = -7)) -> df3.3

df3.01 %>% 
  tidytable::bind_rows(df3.1) %>% 
  tidytable::bind_rows(df3.2) %>% 
  tidytable::bind_rows(df3.3) %>% 
  tidytable::mutate(scenario = forcats::fct_inorder(scenario)) -> df4
df4 -> df4.1.b



```





### DATA: Samples VS Trip
```{r, fig.width=8}

out_23.1 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_23.2_ISS_500_iters_2025-02-09.RDS")

year = out_23.1$samples_1$trip_0.5$length$iss$YEAR


df = tidytable(year = year,
               N1_H0.5 = out_23.1$samples_1$trip_0.5$length$iss$iss,
               N5_H0.5 = out_23.1$samples_5$trip_0.5$length$iss$iss,
               N10_H0.5 = out_23.1$samples_10$trip_0.5$length$iss$iss,
               N15_H0.5 = out_23.1$samples_15$trip_0.5$length$iss$iss,
               N20_H0.5 = out_23.1$samples_20$trip_0.5$length$iss$iss,
               N25_H0.5 = out_23.1$samples_25$trip_0.5$length$iss$iss,
               N30_H0.5 = out_23.1$samples_30$trip_0.5$length$iss$iss,
               N35_H0.5 = out_23.1$samples_35$trip_0.5$length$iss$iss,
               N1_H0.75 = out_23.1$samples_1$trip_0.75$length$iss$iss,
               N5_H0.75 = out_23.1$samples_5$trip_0.75$length$iss$iss,
               N10_H0.75 = out_23.1$samples_10$trip_0.75$length$iss$iss,
               N15_H0.75 = out_23.1$samples_15$trip_0.75$length$iss$iss,
               N20_H0.75 = out_23.1$samples_20$trip_0.75$length$iss$iss,
               N25_H0.75 = out_23.1$samples_25$trip_0.75$length$iss$iss,
               N30_H0.75 = out_23.1$samples_30$trip_0.75$length$iss$iss,
               N35_H0.75 = out_23.1$samples_35$trip_0.75$length$iss$iss,
               N1_H1.0 = out_22.1$samples_1$expansion_haul_month_numbers$length$iss$iss,
               N5_H1.0 = out_22.1$samples_5$expansion_haul_month_numbers$length$iss$iss,
               N10_H1.0 = out_22.1$samples_10$expansion_haul_month_numbers$length$iss$iss,
               N15_H1.0 = out_22.1$samples_15$expansion_haul_month_numbers$length$iss$iss,
               N20_H1.0 = out_22.1$samples_20$expansion_haul_month_numbers$length$iss$iss,
               N25_H1.0 = out_22.1$samples_25$expansion_haul_month_numbers$length$iss$iss,
               N30_H1.0 = out_22.1$samples_30$expansion_haul_month_numbers$length$iss$iss,
               N35_H1.0 = out_22.1$samples_35$expansion_haul_month_numbers$length$iss$iss,
               N1_H1.25 = out_23.1$samples_1$trip_1.25$length$iss$iss,
               N5_H1.25 = out_23.1$samples_5$trip_1.25$length$iss$iss,
               N10_H1.25 = out_23.1$samples_10$trip_1.25$length$iss$iss,
               N15_H1.25 = out_23.1$samples_15$trip_1.25$length$iss$iss,
               N20_H1.25 = out_23.1$samples_20$trip_1.25$length$iss$iss,
               N25_H1.25 = out_23.1$samples_25$trip_1.25$length$iss$iss,
               N30_H1.25 = out_23.1$samples_30$trip_1.25$length$iss$iss,
               N35_H1.25 = out_23.1$samples_35$trip_1.25$length$iss$iss) 

df2 = melt.data.table(df, id.vars = "year", variable.name = "scenario", value.name = "ISS")

df2[grep("H0.5", scenario)] %>% 
  tidytable::mutate(ISS.error = (ISS - df2$ISS[df2$scenario=="N20_H1.0"])/df2$ISS[df2$scenario=="N20_H1.0"],
                    type = "0.5",
                    .by = scenario) %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 1, end = -6)) -> df3.01


df2[grep("H0.75", scenario)] %>% 
  tidytable::mutate(ISS.error = (ISS - df2$ISS[df2$scenario=="N20_H1.0"])/df2$ISS[df2$scenario=="N20_H1.0"],
                    type = "0.75",
                    .by = scenario) %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 1, end = -7)) -> df3.1

df2[grep("H1.0", scenario)] %>% 
  tidytable::mutate(ISS.error = (ISS - df2$ISS[df2$scenario=="N20_H1.0"])/df2$ISS[df2$scenario=="N20_H1.0"],
                    type = "1.0",
                    .by = scenario) %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 1, end = -6)) -> df3.2

df2[grep("H1.25", scenario)] %>% 
  tidytable::mutate(ISS.error = (ISS - df2$ISS[df2$scenario=="N20_H1.0"])/df2$ISS[df2$scenario=="N20_H1.0"],
                    type = "1.25",
                    .by = scenario) %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 1, end = -7)) -> df3.3

df3.01 %>% 
  tidytable::bind_rows(df3.1) %>% 
  tidytable::bind_rows(df3.2) %>% 
  tidytable::bind_rows(df3.3) %>% 
  tidytable::mutate(scenario = forcats::fct_inorder(scenario)) -> df4
df4 -> df4.2.b



```










### DATA: Samples VS Trip/Haul
```{r, fig.width=8}

# out_25.1 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_25.1_ISS_200_iters_2025-01-03.RDS")
out_25.1 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_25.3.TAS_ISS_500_iters_2025-02-12.RDS")

# year = out_25.1$samples_1$haul_0.5_trip_0.5$length$iss$YEAR
year = out_25.1$samples_1$haul_0.5_trip_0.75$length$iss$YEAR


df = tidytable(year = year,
               N1_H0.5_T0.5 = out_25.1$samples_1$haul_0.5_trip_0.5$length$iss$iss,
               N5_H0.5_T0.5 = out_25.1$samples_5$haul_0.5_trip_0.5$length$iss$iss,
               N10_H0.5_T0.5 = out_25.1$samples_10$haul_0.5_trip_0.5$length$iss$iss,
               N15_H0.5_T0.5 = out_25.1$samples_15$haul_0.5_trip_0.5$length$iss$iss,
               N20_H0.5_T0.5 = out_25.1$samples_20$haul_0.5_trip_0.5$length$iss$iss,
               N25_H0.5_T0.5 = out_25.1$samples_25$haul_0.5_trip_0.5$length$iss$iss,
               N30_H0.5_T0.5 = out_25.1$samples_30$haul_0.5_trip_0.5$length$iss$iss,
               N35_H0.5_T0.5 = out_25.1$samples_35$haul_0.5_trip_0.5$length$iss$iss,
               
               N1_H0.5_T0.75 = out_25.1$samples_1$haul_0.5_trip_0.75$length$iss$iss,
               N5_H0.5_T0.75 = out_25.1$samples_5$haul_0.5_trip_0.75$length$iss$iss,
               N10_H0.5_T0.75 = out_25.1$samples_10$haul_0.5_trip_0.75$length$iss$iss,
               N15_H0.5_T0.75 = out_25.1$samples_15$haul_0.5_trip_0.75$length$iss$iss,
               N20_H0.5_T0.75 = out_25.1$samples_20$haul_0.5_trip_0.75$length$iss$iss,
               N25_H0.5_T0.75 = out_25.1$samples_25$haul_0.5_trip_0.75$length$iss$iss,
               N30_H0.5_T0.75 = out_25.1$samples_30$haul_0.5_trip_0.75$length$iss$iss,
               N35_H0.5_T0.75 = out_25.1$samples_35$haul_0.5_trip_0.75$length$iss$iss,
               
               N1_H0.75_T0.5 = out_25.1$samples_1$haul_0.75_trip_0.5$length$iss$iss,
               N5_H0.75_T0.5 = out_25.1$samples_5$haul_0.75_trip_0.5$length$iss$iss,
               N10_H0.75_T0.5 = out_25.1$samples_10$haul_0.75_trip_0.5$length$iss$iss,
               N15_H0.75_T0.5 = out_25.1$samples_15$haul_0.75_trip_0.5$length$iss$iss,
               N20_H0.75_T0.5 = out_25.1$samples_20$haul_0.75_trip_0.5$length$iss$iss,
               N25_H0.75_T0.5 = out_25.1$samples_25$haul_0.75_trip_0.5$length$iss$iss,
               N30_H0.75_T0.5 = out_25.1$samples_30$haul_0.75_trip_0.5$length$iss$iss,
               N35_H0.75_T0.5 = out_25.1$samples_35$haul_0.75_trip_0.5$length$iss$iss,
               
               N1_H0.75_T0.75 = out_25.1$samples_1$haul_0.75_trip_0.75$length$iss$iss,
               N5_H0.75_T0.75 = out_25.1$samples_5$haul_0.75_trip_0.75$length$iss$iss,
               N10_H0.75_T0.75 = out_25.1$samples_10$haul_0.75_trip_0.75$length$iss$iss,
               N15_H0.75_T0.75 = out_25.1$samples_15$haul_0.75_trip_0.75$length$iss$iss,
               N20_H0.75_T0.75 = out_25.1$samples_20$haul_0.75_trip_0.75$length$iss$iss,
               N25_H0.75_T0.75 = out_25.1$samples_25$haul_0.75_trip_0.75$length$iss$iss,
               N30_H0.75_T0.75 = out_25.1$samples_30$haul_0.75_trip_0.75$length$iss$iss,
               N35_H0.75_T0.75 = out_25.1$samples_35$haul_0.75_trip_0.75$length$iss$iss,
               
               N1_H1.25_T0.5 = out_25.1$samples_1$haul_1.25_trip_0.5$length$iss$iss,
               N5_H1.25_T0.5 = out_25.1$samples_5$haul_1.25_trip_0.5$length$iss$iss,
               N10_H1.25_T0.5 = out_25.1$samples_10$haul_1.25_trip_0.5$length$iss$iss,
               N15_H1.25_T0.5 = out_25.1$samples_15$haul_1.25_trip_0.5$length$iss$iss,
               N20_H1.25_T0.5 = out_25.1$samples_20$haul_1.25_trip_0.5$length$iss$iss,
               N25_H1.25_T0.5 = out_25.1$samples_25$haul_1.25_trip_0.5$length$iss$iss,
               N30_H1.25_T0.5 = out_25.1$samples_30$haul_1.25_trip_0.5$length$iss$iss,
               N35_H1.25_T0.5 = out_25.1$samples_35$haul_1.25_trip_0.5$length$iss$iss,
               
               N1_H1.25_T0.75 = out_25.1$samples_1$haul_1.25_trip_0.75$length$iss$iss,
               N5_H1.25_T0.75 = out_25.1$samples_5$haul_1.25_trip_0.75$length$iss$iss,
               N10_H1.25_T0.75 = out_25.1$samples_10$haul_1.25_trip_0.75$length$iss$iss,
               N15_H1.25_T0.75 = out_25.1$samples_15$haul_1.25_trip_0.75$length$iss$iss,
               N20_H1.25_T0.75 = out_25.1$samples_20$haul_1.25_trip_0.75$length$iss$iss,
               N25_H1.25_T0.75 = out_25.1$samples_25$haul_1.25_trip_0.75$length$iss$iss,
               N30_H1.25_T0.75 = out_25.1$samples_30$haul_1.25_trip_0.75$length$iss$iss,
               N35_H1.25_T0.75 = out_25.1$samples_35$haul_1.25_trip_0.75$length$iss$iss,
               
               N1_H1.0_T1.0 = out_22.1$samples_1$expansion_haul_month_numbers$length$iss$iss,
               N5_H1.0_T1.0 = out_22.1$samples_5$expansion_haul_month_numbers$length$iss$iss,
               N10_H1.0_T1.0 = out_22.1$samples_10$expansion_haul_month_numbers$length$iss$iss,
               N15_H1.0_T1.0 = out_22.1$samples_15$expansion_haul_month_numbers$length$iss$iss,
               N20_H1.0_T1.0 = out_22.1$samples_20$expansion_haul_month_numbers$length$iss$iss,
               N25_H1.0_T1.0 = out_22.1$samples_25$expansion_haul_month_numbers$length$iss$iss,
               N30_H1.0_T1.0 = out_22.1$samples_30$expansion_haul_month_numbers$length$iss$iss,
               N35_H1.0_T1.0 = out_22.1$samples_35$expansion_haul_month_numbers$length$iss$iss) 

df2 = melt.data.table(df, id.vars = "year", variable.name = "scenario", value.name = "ISS")

scenario_names = c("H0.5_T0.5", "H0.5_T0.75", "H0.75_T0.5", "H0.75_T0.75", "H1.25_T0.5", "H1.25_T0.75", "H1.0_T1.0")
scenario_names.short = c("0.5/0.5", "0.5/0.75", "0.75/0.5", "0.75/0.75", "1.25/0.5", "1.25/0.75", "1.0/1.0")

## 1
df2[grep(scenario_names[1], scenario)] %>% 
  tidytable::mutate(ISS.error = (ISS - df2$ISS[df2$scenario=="N20_H1.0_T1.0"])/df2$ISS[df2$scenario=="N20_H1.0_T1.0"],
                    type = scenario_names.short[1],
                    .by = scenario) %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 1, end = -(nchar(scenario_names[1])+2))) -> df3.1

## 2
df2[grep(scenario_names[2], scenario)] %>% 
  tidytable::mutate(ISS.error = (ISS - df2$ISS[df2$scenario=="N20_H1.0_T1.0"])/df2$ISS[df2$scenario=="N20_H1.0_T1.0"],
                    type = scenario_names.short[2],
                    .by = scenario) %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 1, end = -(nchar(scenario_names[2])+2))) -> df3.2

## 3
df2[grep(scenario_names[3], scenario)] %>% 
  tidytable::mutate(ISS.error = (ISS - df2$ISS[df2$scenario=="N20_H1.0_T1.0"])/df2$ISS[df2$scenario=="N20_H1.0_T1.0"],
                    type = scenario_names.short[3],
                    .by = scenario) %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 1, end = -(nchar(scenario_names[3])+2))) -> df3.3


## 4
df2[grep(scenario_names[4], scenario)] %>% 
  tidytable::mutate(ISS.error = (ISS - df2$ISS[df2$scenario=="N20_H1.0_T1.0"])/df2$ISS[df2$scenario=="N20_H1.0_T1.0"],
                    type = scenario_names.short[4],
                    .by = scenario) %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 1, end = -(nchar(scenario_names[4])+2))) -> df3.4

## 5
df2[grep(scenario_names[5], scenario)] %>% 
  tidytable::mutate(ISS.error = (ISS - df2$ISS[df2$scenario=="N20_H1.0_T1.0"])/df2$ISS[df2$scenario=="N20_H1.0_T1.0"],
                    type = scenario_names.short[5],
                    .by = scenario) %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 1, end = -(nchar(scenario_names[5])+2))) -> df3.5

## 6
df2[grep(scenario_names[6], scenario)] %>% 
  tidytable::mutate(ISS.error = (ISS - df2$ISS[df2$scenario=="N20_H1.0_T1.0"])/df2$ISS[df2$scenario=="N20_H1.0_T1.0"],
                    type = scenario_names.short[6],
                    .by = scenario) %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 1, end = -(nchar(scenario_names[6])+2))) -> df3.6

## 7
df2[grep(scenario_names[7], scenario)] %>% 
  tidytable::mutate(ISS.error = (ISS - df2$ISS[df2$scenario=="N20_H1.0_T1.0"])/df2$ISS[df2$scenario=="N20_H1.0_T1.0"],
                    type = scenario_names.short[7],
                    .by = scenario) %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 1, end = -(nchar(scenario_names[7])+2))) -> df3.7




df3.1 %>% 
  tidytable::bind_rows(df3.2) %>% 
  tidytable::bind_rows(df3.3) %>% 
  tidytable::bind_rows(df3.4) %>% 
  tidytable::bind_rows(df3.5) %>% 
  tidytable::bind_rows(df3.6) %>% 
  tidytable::bind_rows(df3.7) %>% 
  tidytable::mutate(scenario = forcats::fct_inorder(scenario)) -> df4
df4 -> df4.3.b



```




### * 3 Panel: Sample Size VS Haul, Trip, Haul/Trip 

```{r, fig.height=12, fig.width=10}
p1 = df4.2.b %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 2, end = -1)) %>%
  tidytable::mutate(scenario = forcats::fct_inorder(scenario)) %>% 
  ggplot(aes(x = scenario, y = ISS.error*100)) +
  geom_boxplot(aes(fill = type)) +
  labs(x = "", y = "ISSB % Difference", tag = "A") +
  theme_classic() +
  theme(legend.position = c(0.7, 0.15), 
        legend.direction = "horizontal", 
        legend.box = "horizontal",
        plot.tag.position = c(0.1, 0.95),
        plot.tag = element_text(size = 14, face = "bold")) + 
  guides(fill = guide_legend(title = "Trips",
                             title.position = "top", 
                             title.hjust = 0.5,
                             label.position = "bottom"))  +
  geom_hline(yintercept = -10, linetype = "dashed", color = "black") +
  geom_hline(yintercept = 10, linetype = "dashed", color = "black") +
  scale_y_continuous(breaks = seq(-100, 120, by = 10), limits = c(-90, 30))

p2 = df4.1.b %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 2, end = -1)) %>% 
  tidytable::mutate(scenario = forcats::fct_inorder(scenario)) %>% 
  ggplot(aes(x = scenario, y = ISS.error*100)) +
  geom_boxplot(aes(fill = type)) +
  labs(x = "", y = "ISSB % Difference", tag = "B") +
  theme_classic() +
  theme(legend.position = c(0.7, 0.15), 
        legend.direction = "horizontal", 
        legend.box = "horizontal",
        plot.tag.position = c(0.1, 0.95),
        plot.tag = element_text(size = 14, face = "bold")) + 
  guides(fill = guide_legend(title = "Hauls",
                             title.position = "top", 
                             title.hjust = 0.5,
                             label.position = "bottom"))  +
  geom_hline(yintercept = -10, linetype = "dashed", color = "black") +
  geom_hline(yintercept = 10, linetype = "dashed", color = "black") +
  scale_y_continuous(breaks = seq(-100, 120, by = 10), limits = c(-90, 30))

p3 = df4.3.b %>% 
  tidytable::mutate(scenario = factor(str_sub(scenario, start = 2, end = -1))) %>% 
  tidytable::filter(type %in% scenario_names.short[c(2,4,5,6,7)]) %>%
  tidytable::mutate(scenario = forcats::fct_inorder(scenario)) %>% 
  ggplot(aes(x = scenario, y = ISS.error*100)) +
  geom_boxplot(aes(fill = type)) +
  labs(x = "Samples per Haul", y = "ISSB % Difference", tag = "C") +
  theme_classic() +
  theme(legend.position = c(0.7, 0.15), 
        legend.direction = "horizontal", 
        legend.box = "horizontal",
        plot.tag.position = c(0.1, 0.95),
        plot.tag = element_text(size = 14, face = "bold")) + 
  guides(fill = guide_legend(title = "Hauls/Trips",
                             title.position = "top", 
                             title.hjust = 0.5,
                             label.position = "bottom"))  +
  geom_hline(yintercept = -10, linetype = "dashed", color = "black") +
  geom_hline(yintercept = 10, linetype = "dashed", color = "black") +
  scale_y_continuous(breaks = seq(-100, 120, by = 10), limits = c(-90, 30))



p1 + plot_spacer() + p2 + plot_spacer() + p3 + plot_layout(ncol = 1,
                           heights = c(6, -.5, 6, -.5, 6))

```









### * 4 Panel: Sample Size VS Expansion, Haul, Trip, Haul/Trip 
\newpage

```{r, fig.height=14, fig.width=10}

p0 = df4.0 %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 2, end = -1)) %>%
  tidytable::mutate(type = str_sub(type, start = 2, end = -1)) %>%
  tidytable::mutate(scenario = forcats::fct_inorder(scenario)) %>% 
  ggplot(aes(x = scenario, y = ISS.error*100)) +
  geom_boxplot(aes(fill = type)) +
  labs(x = "", y = "ISSB % Difference", tag = "A") +
  theme_classic() +
  theme(legend.position = c(0.7, 0.15), 
        legend.direction = "horizontal", 
        legend.box = "horizontal",
        plot.tag.position = c(0.1, 0.95),
        plot.tag = element_text(size = 14, face = "bold")) + 
  guides(fill = guide_legend(title = "Expansion Complexity",
                             title.position = "top", 
                             title.hjust = 0.5,
                             label.position = "bottom"))  +
  geom_hline(yintercept = -10, linetype = "dashed", color = "black") +
  geom_hline(yintercept = 10, linetype = "dashed", color = "black") +
  scale_y_continuous(breaks = seq(-100, 120, by = 10), limits = c(-90, 20))




p1 = df4.2.b %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 2, end = -1)) %>%
  tidytable::mutate(scenario = forcats::fct_inorder(scenario)) %>% 
  ggplot(aes(x = scenario, y = ISS.error*100)) +
  geom_boxplot(aes(fill = type)) +
  labs(x = "", y = "ISSB % Difference", tag = "B") +
  theme_classic() +
  theme(legend.position = c(0.7, 0.15), 
        legend.direction = "horizontal", 
        legend.box = "horizontal",
        plot.tag.position = c(0.1, 0.95),
        plot.tag = element_text(size = 14, face = "bold")) + 
  guides(fill = guide_legend(title = "Proportion of Trips",
                             title.position = "top", 
                             title.hjust = 0.5,
                             label.position = "bottom"))  +
  geom_hline(yintercept = -10, linetype = "dashed", color = "black") +
  geom_hline(yintercept = 10, linetype = "dashed", color = "black") +
  scale_y_continuous(breaks = seq(-100, 120, by = 10), limits = c(-90, 20))

p2 = df4.1.b %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 2, end = -1)) %>% 
  tidytable::mutate(scenario = forcats::fct_inorder(scenario)) %>% 
  ggplot(aes(x = scenario, y = ISS.error*100)) +
  geom_boxplot(aes(fill = type)) +
  labs(x = "", y = "ISSB % Difference", tag = "C") +
  theme_classic() +
  theme(legend.position = c(0.7, 0.15), 
        legend.direction = "horizontal", 
        legend.box = "horizontal",
        plot.tag.position = c(0.1, 0.95),
        plot.tag = element_text(size = 14, face = "bold")) + 
  guides(fill = guide_legend(title = "Proportion of Hauls",
                             title.position = "top", 
                             title.hjust = 0.5,
                             label.position = "bottom"))  +
  geom_hline(yintercept = -10, linetype = "dashed", color = "black") +
  geom_hline(yintercept = 10, linetype = "dashed", color = "black") +
  scale_y_continuous(breaks = seq(-100, 120, by = 10), limits = c(-90, 20))

p3 = df4.3.b %>% 
  tidytable::mutate(scenario = factor(str_sub(scenario, start = 2, end = -1))) %>% 
  tidytable::filter(type %in% scenario_names.short[c(2,4,5,6,7)]) %>%
  tidytable::mutate(scenario = forcats::fct_inorder(scenario)) %>% 
  ggplot(aes(x = scenario, y = ISS.error*100)) +
  geom_boxplot(aes(fill = type)) +
  labs(x = "Samples per Haul", y = "ISSB % Difference", tag = "D") +
  theme_classic() +
  theme(legend.position = c(0.7, 0.15), 
        legend.direction = "horizontal", 
        legend.box = "horizontal",
        plot.tag.position = c(0.1, 0.95),
        plot.tag = element_text(size = 14, face = "bold")) + 
  guides(fill = guide_legend(title = "Proportion of Hauls/Trips",
                             title.position = "top", 
                             title.hjust = 0.5,
                             label.position = "bottom"))  +
  geom_hline(yintercept = -10, linetype = "dashed", color = "black") +
  geom_hline(yintercept = 10, linetype = "dashed", color = "black") +
  scale_y_continuous(breaks = seq(-100, 120, by = 10), limits = c(-90, 20))



p0 + plot_spacer() + p1 + plot_spacer() + p2 + plot_spacer() + p3 + plot_layout(ncol = 1,
                           heights = c(6, -.7, 6, -.7, 6, -.7, 6))

```



\newpage




### * DATA: NEW reduce samples
```{r}
out_31.1 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_31.1.TAS_ISS_500_iters_2025-03-02.RDS")

year = out_31.1$samples_1$data_H_P$length$iss$YEAR


### H_P ###################
df = tidytable(year = year,
               N1_HP = out_31.1$samples_1$data_H_P$length$iss$iss,
               N5_HP = out_31.1$samples_5$data_H_P$length$iss$iss,
               N10_HP = out_31.1$samples_10$data_H_P$length$iss$iss,
               N15_HP = out_31.1$samples_15$data_H_P$length$iss$iss,
               N20_HP = out_31.1$samples_20$data_H_P$length$iss$iss,
               
               NN_HP = out_1.4$length$iss$iss[out_1.4$length$iss$YEAR%in%1999:2023])

########## PROBLEM: these should be the same! I think the problem is that I ran it on TAS without updating baseISS from github.
# (out_27.1$length$iss$iss[out_27.1$length$iss$YEAR%in%1999:2023]-out_31.1$samples_20$data_H_P$length$iss$iss) %>% boxplot()
out_27.1$length$iss$iss[out_27.1$length$iss$YEAR%in%1999:2023]-out_31.1$samples_5$data_H_P$length$iss$iss
# (df2[scenario=="full"]$ISS - out_1.4$length$iss$iss[out_1.4$length$iss$YEAR%in%1999:2023]) %>% boxplot()

df2 = melt.data.table(df, id.vars = "year", variable.name = "scenario", value.name = "ISS")

scenario_names = c("N1_HP", "N5_HP", "N10_HP", "N15_HP", "N20_HP", "NN_HP")


## 1
df2 %>% 
  tidytable::mutate(ISS.error = 100*(ISS - df2$ISS[df2$scenario=="N20_HP"])/df2$ISS[df2$scenario=="N20_HP"],
                    type = "relative_20",
                    .by = scenario) -> df3.1
## 2
df2 %>% 
  tidytable::mutate(ISS.error = 100*(ISS - df2$ISS[df2$scenario=="NN_HP"])/df2$ISS[df2$scenario=="NN_HP"],
                    type = "relative_N",
                    .by = scenario) -> df3.2


df3.1 %>% 
  tidytable::bind_rows(df3.2) %>%
  tidytable::filter(scenario!="NN_HP") %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 2, end = -4)) %>%
  tidytable::mutate(scenario = forcats::fct_inorder(scenario)) -> df4
df4 -> df4.a




### H ###################
df = tidytable(year = year,
               N1_H = out_31.1$samples_1$data_H$length$iss$iss,
               N5_H = out_31.1$samples_5$data_H$length$iss$iss,
               N10_H = out_31.1$samples_10$data_H$length$iss$iss,
               N15_H = out_31.1$samples_15$data_H$length$iss$iss,
               N20_H = out_31.1$samples_20$data_H$length$iss$iss,
               
               NN_H = out_1.4$length$iss$iss[out_1.4$length$iss$YEAR%in%1999:2023])


df2 = melt.data.table(df, id.vars = "year", variable.name = "scenario", value.name = "ISS")

scenario_names = c("N1_H", "N5_H", "N10_H", "N15_H", "N20_H", "NN_H")


## 1
df2 %>% 
  tidytable::mutate(ISS.error = 100*(ISS - df2$ISS[df2$scenario=="N20_H"])/df2$ISS[df2$scenario=="N20_H"],
                    type = "relative_20",
                    .by = scenario) -> df3.1
## 2
df2 %>% 
  tidytable::mutate(ISS.error = 100*(ISS - df2$ISS[df2$scenario=="NN_H"])/df2$ISS[df2$scenario=="NN_H"],
                    type = "relative_N",
                    .by = scenario) -> df3.2


df3.1 %>% 
  tidytable::bind_rows(df3.2) %>%
  tidytable::filter(scenario!="NN_H") %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 2, end = -3)) %>%
  tidytable::mutate(scenario = forcats::fct_inorder(scenario)) -> df4
df4 -> df4.b





### H 20 only ###################
out_32.1 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_32.1_ISS_500_iters_2025-03-03.RDS")

year = out_32.1$samples_1$data_H_20$length$iss$YEAR



df = tidytable(year = year,
               N1_H20 = out_32.1$samples_1$data_H_20$length$iss$iss,
               N5_H20 = out_32.1$samples_5$data_H_20$length$iss$iss,
               N10_H20 = out_32.1$samples_10$data_H_20$length$iss$iss,
               N15_H20 = out_32.1$samples_15$data_H_20$length$iss$iss,
               N20_H20 = out_32.1$samples_20$data_H_20$length$iss$iss,
               
               NN_HP = out_1.4$length$iss$iss[out_1.4$length$iss$YEAR%in%1999:2023])


df2 = melt.data.table(df, id.vars = "year", variable.name = "scenario", value.name = "ISS")



## 1
df2 %>% 
  tidytable::mutate(ISS.error = 100*(ISS - df2$ISS[df2$scenario=="N20_H20"])/df2$ISS[df2$scenario=="N20_H20"],
                    type = "relative_H20",
                    .by = scenario) -> df3.1
## 2
df2 %>% 
  tidytable::mutate(ISS.error = 100*(ISS - df2$ISS[df2$scenario=="NN_HP"])/df2$ISS[df2$scenario=="NN_HP"],
                    type = "relative_N",
                    .by = scenario) -> df3.2


df3.1 %>% 
  tidytable::bind_rows(df3.2) %>%
  tidytable::filter(scenario!="NN_HP") %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 2, end = -5)) %>%
  tidytable::mutate(scenario = forcats::fct_inorder(scenario)) -> df4
df4 -> df4.c







# 
# ### Port only ###################
# out_36.1 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_36.1_ISS_500_iters_2025-03-06.RDS")
# 
# year = out_36.1$samples_1$data_P$length$iss$YEAR
# 
# # # manually insert a zero for samples=1 year 2021 because only one port sample in 2021
# # out_36.1$samples_1$data_P$length$iss$iss[out_36.1$samples_1$data_P$length$iss$YEAR==2021] = 0
# # 
# 
# 
# df = tidytable(year = year,
#                N1_P = out_36.1$samples_1$data_P$length$iss$iss,
#                N5_P = out_36.1$samples_5$data_P$length$iss$iss,
#                N10_P = out_36.1$samples_10$data_P$length$iss$iss,
#                N15_P = out_36.1$samples_15$data_P$length$iss$iss,
#                N20_P = out_36.1$samples_20$data_P$length$iss$iss,
#                
#                NN_P = out_36.1$samples_999$data_P$length$iss$iss)
# 
# 
# df2 = melt.data.table(df, id.vars = "year", variable.name = "scenario", value.name = "ISS")
# 
# 
# 
# ## 1
# df2 %>% 
#   tidytable::mutate(ISS.error = 100*(ISS - df2$ISS[df2$scenario=="N20_H20"])/df2$ISS[df2$scenario=="N20_H20"],
#                     type = "relative_H20",
#                     .by = scenario) -> df3.1
# ## 2
# df2 %>% 
#   tidytable::mutate(ISS.error = 100*(ISS - df2$ISS[df2$scenario=="NN_HP"])/df2$ISS[df2$scenario=="NN_HP"],
#                     type = "relative_N",
#                     .by = scenario) -> df3.2
# 
# 
# df3.1 %>% 
#   tidytable::bind_rows(df3.2) %>%
#   tidytable::filter(scenario!="NN_HP") %>% 
#   tidytable::mutate(scenario = str_sub(scenario, start = 2, end = -5)) %>%
#   tidytable::mutate(scenario = forcats::fct_inorder(scenario)) -> df4
# df4 -> df4.c
# 


```

\newpage

```{r, fig.height=8}
### plots

p1 = df4.a %>%
  ggplot(aes(x = scenario, y = ISS.error)) +
  geom_boxplot(aes(fill = type)) +
  labs(x = "", y = "ISSB % Difference", tag = "A") +
  theme_classic() +
  theme(legend.position = c(0.7, 0.15), 
        legend.direction = "horizontal", 
        legend.box = "horizontal",
        plot.tag.position = c(0.1, 0.95),
        plot.tag = element_text(size = 14, face = "bold")) + 
  guides(fill = guide_legend(title = "haul and port data",
                             title.position = "top", 
                             title.hjust = 0.5,
                             label.position = "bottom"))  +
  geom_hline(yintercept = -10, linetype = "dashed", color = "black") +
  geom_hline(yintercept = 0, linetype = "solid", color = "black") +
  # geom_hline(yintercept = 10, linetype = "dashed", color = "black") +
  scale_y_continuous(breaks = seq(-100, 120, by = 10), limits = c(-80, 10))


p2 = df4.b %>%
  ggplot(aes(x = scenario, y = ISS.error)) +
  geom_boxplot(aes(fill = type)) +
  labs(x = "Samples per Haul", y = "ISSB % Difference", tag = "B") +
  theme_classic() +
  theme(legend.position = c(0.7, 0.15), 
        legend.direction = "horizontal", 
        legend.box = "horizontal",
        plot.tag.position = c(0.1, 0.95),
        plot.tag = element_text(size = 14, face = "bold")) + 
  guides(fill = guide_legend(title = "haul only data",
                             title.position = "top", 
                             title.hjust = 0.5,
                             label.position = "bottom"))  +
  geom_hline(yintercept = -10, linetype = "dashed", color = "black") +
  geom_hline(yintercept = 0, linetype = "solid", color = "black") +
  # geom_hline(yintercept = 10, linetype = "dashed", color = "black") +
  scale_y_continuous(breaks = seq(-100, 120, by = 10), limits = c(-80, 10))


p3 = df4.c %>%
  ggplot(aes(x = scenario, y = ISS.error)) +
  geom_boxplot(aes(fill = type)) +
  labs(x = "Samples per Haul", y = "ISSB % Difference", tag = "optional C") +
  theme_classic() +
  theme(legend.position = c(0.7, 0.15), 
        legend.direction = "horizontal", 
        legend.box = "horizontal",
        plot.tag.position = c(0.1, 0.95),
        plot.tag = element_text(size = 14, face = "bold")) + 
  guides(fill = guide_legend(title = "haul=20 only data",
                             title.position = "top", 
                             title.hjust = 0.5,
                             label.position = "bottom"))  +
  geom_hline(yintercept = -10, linetype = "dashed", color = "black") +
  geom_hline(yintercept = 0, linetype = "solid", color = "black") +
  # geom_hline(yintercept = 10, linetype = "dashed", color = "black") +
  scale_y_continuous(breaks = seq(-100, 120, by = 10), limits = c(-80, 10))




p1 + plot_spacer() + p2 + plot_layout(ncol = 1,
                           heights = c(6, -.5, 6))


p3


```

\newpage

for above. "the median percent difference in ISSB increased with increasing sample size using the full data set (A) and only the haul data (B) over the period 1999-2023. There was no appreciable change in the percent difference when only using the haul data. There was also very little difference comparing the percent difference relative to the baseline ISSB or relative to applying the sample reduction routine at a sampling rate of 20. This verifies that the results are comparable for the following scenarios: comparisons to the baseline or comparisons to just using hauls with a sampling rate that never exceeds 20. The most conservative scenario is assuming a future sampling where high sampling rates from port samples are not available and the haul sampling rate is allowed to be below 20 but not exceed it. Comparisons relative to this scenario are the most relevant, conservative, scenario available to evaluate the impact of reducing observer haul sampling rate on composition data precision for future years. If the sampling rate behavior continues on average at least as good as it has done for the period 1999:2023 (which it is scheduled to do), we can expect the loss of precision not to exceed these values. (Assuming fishing trip and haul characteristics are comparable on average, also likely expected). 



\newpage


### NEW Haul and TRIP Decrease
```{r, eval=F}
out_29.1 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_29.1_ISS_500_iters_2025-03-02.RDS")

year = out_29.1$proportion_0.1$type_trip$length$iss$YEAR


# Trip
df = tidytable(year = year,
               N_0.1 = out_29.1$proportion_0.1$type_trip$length$iss$iss,
               N_0.2 = out_29.1$proportion_0.2$type_trip$length$iss$iss,
               N_0.3 = out_29.1$proportion_0.3$type_trip$length$iss$iss,
               N_0.4 = out_29.1$proportion_0.4$type_trip$length$iss$iss,
               N_0.5 = out_29.1$proportion_0.5$type_trip$length$iss$iss,
               N_0.6 = out_29.1$proportion_0.6$type_trip$length$iss$iss,
               N_0.7 = out_29.1$proportion_0.7$type_trip$length$iss$iss,
               N_0.8 = out_29.1$proportion_0.8$type_trip$length$iss$iss,
               N_0.9 = out_29.1$proportion_0.9$type_trip$length$iss$iss)

df2 = melt.data.table(df, id.vars = "year", variable.name = "scenario", value.name = "ISS")

df2 %>% 
  tidytable::mutate(ISS.error = (ISS - out_1.4$length$iss$iss)/out_1.4$length$iss$iss,
                    type = "trip",
                    .by = scenario) -> df3.1

# Haul
df = tidytable(year = year,
               N_0.1 = out_29.1$proportion_0.1$type_haul$length$iss$iss,
               N_0.2 = out_29.1$proportion_0.2$type_haul$length$iss$iss,
               N_0.3 = out_29.1$proportion_0.3$type_haul$length$iss$iss,
               N_0.4 = out_29.1$proportion_0.4$type_haul$length$iss$iss,
               N_0.5 = out_29.1$proportion_0.5$type_haul$length$iss$iss,
               N_0.6 = out_29.1$proportion_0.6$type_haul$length$iss$iss,
               N_0.7 = out_29.1$proportion_0.7$type_haul$length$iss$iss,
               N_0.8 = out_29.1$proportion_0.8$type_haul$length$iss$iss,
               N_0.9 = out_29.1$proportion_0.9$type_haul$length$iss$iss)

df2 = melt.data.table(df, id.vars = "year", variable.name = "scenario", value.name = "ISS")


df2 %>% 
  tidytable::mutate(ISS.error = (ISS - out_1.4$length$iss$iss)/out_1.4$length$iss$iss,
                    type = "haul",
                    .by = scenario) -> df3.2

df3.1 %>% 
  tidytable::bind_rows(df3.2) -> df4


df4 %>% 
  ggplot(aes(x = scenario, y = ISS.error*100)) +
  geom_boxplot(aes(fill = type)) +
  labs(x = "Proportional Change", y = "ISSB % Difference") +
  theme_classic() +
  theme(legend.position = c(0.8, 0.2)) +
  geom_hline(yintercept = 0, linetype = "solid", color = "black") +
  geom_hline(yintercept = -10, linetype = "dashed", color = "black") +
  scale_y_continuous(breaks = seq(-100, 20, by = 10), limits = c(-100, 20)) +
  scale_x_discrete(labels = c("0.1", "0.2", "0.3", "0.4", "0.5", "0.6", "0.7", "0.8", "0.9"))

```






### NEW Haul and TRIP Decrease w/o replacement
```{r}
out_29.1 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_33.1.TAS_ISS_500_iters_2025-03-04.RDS")

year = out_29.1$proportion_0.1$type_trip$length$iss$YEAR


# Trip
df = tidytable(year = year,
               N_0.1 = out_29.1$proportion_0.1$type_trip$length$iss$iss,
               N_0.2 = out_29.1$proportion_0.2$type_trip$length$iss$iss,
               N_0.3 = out_29.1$proportion_0.3$type_trip$length$iss$iss,
               N_0.4 = out_29.1$proportion_0.4$type_trip$length$iss$iss,
               N_0.5 = out_29.1$proportion_0.5$type_trip$length$iss$iss,
               N_0.6 = out_29.1$proportion_0.6$type_trip$length$iss$iss,
               N_0.7 = out_29.1$proportion_0.7$type_trip$length$iss$iss,
               N_0.8 = out_29.1$proportion_0.8$type_trip$length$iss$iss,
               N_0.9 = out_29.1$proportion_0.9$type_trip$length$iss$iss)

df2 = melt.data.table(df, id.vars = "year", variable.name = "scenario", value.name = "ISS")

df2 %>% 
  tidytable::mutate(ISS.error = (ISS - out_1.4$length$iss$iss)/out_1.4$length$iss$iss,
                    type = "trip",
                    .by = scenario) -> df3.1

# Haul
df = tidytable(year = year,
               N_0.1 = out_29.1$proportion_0.1$type_haul$length$iss$iss,
               N_0.2 = out_29.1$proportion_0.2$type_haul$length$iss$iss,
               N_0.3 = out_29.1$proportion_0.3$type_haul$length$iss$iss,
               N_0.4 = out_29.1$proportion_0.4$type_haul$length$iss$iss,
               N_0.5 = out_29.1$proportion_0.5$type_haul$length$iss$iss,
               N_0.6 = out_29.1$proportion_0.6$type_haul$length$iss$iss,
               N_0.7 = out_29.1$proportion_0.7$type_haul$length$iss$iss,
               N_0.8 = out_29.1$proportion_0.8$type_haul$length$iss$iss,
               N_0.9 = out_29.1$proportion_0.9$type_haul$length$iss$iss)

df2 = melt.data.table(df, id.vars = "year", variable.name = "scenario", value.name = "ISS")


df2 %>% 
  tidytable::mutate(ISS.error = (ISS - out_1.4$length$iss$iss)/out_1.4$length$iss$iss,
                    type = "haul",
                    .by = scenario) -> df3.2

df3.1 %>% 
  tidytable::bind_rows(df3.2) -> df4


df4 %>% 
  ggplot(aes(x = scenario, y = ISS.error*100)) +
  geom_boxplot(aes(fill = type)) +
  labs(x = "Proportional Change", y = "ISSB % Difference") +
  theme_classic() +
  theme(legend.position = c(0.8, 0.2)) +
  geom_hline(yintercept = 0, linetype = "solid", color = "black") +
  geom_hline(yintercept = -10, linetype = "dashed", color = "black") +
  scale_y_continuous(breaks = seq(-100, 20, by = 10), limits = c(-100, 20)) +
  scale_x_discrete(labels = c("0.1", "0.2", "0.3", "0.4", "0.5", "0.6", "0.7", "0.8", "0.9"))

```













## SUPPLEMENTARY MATERIAL
### Plot 7x2 Grid Haul and Trip numbers

CONSIDER MOVING THESE TO SUPPLEMENTARY MATERIAL AND TOTALLY FOCUSING ON 1999-2023 PERIOD.


```{r}



out_18.1 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_18.3.TAS_ISS_500_iters_2025-02-10.RDS")

year = out_18.1$proportion_0.25$type_trip$length$iss$YEAR


# Trip
df = tidytable(year = year,
               N_0.25 = out_18.1$proportion_0.25$type_trip$length$iss$iss,
               N_0.50 = out_18.1$proportion_0.5$type_trip$length$iss$iss,
               N_0.75 = out_18.1$proportion_0.75$type_trip$length$iss$iss,
               N_1.00 = out_1.4$length$iss$iss,
               N_1.25 = out_18.1$proportion_1.25$type_trip$length$iss$iss,
               N_1.50 = out_18.1$proportion_1.5$type_trip$length$iss$iss,
               N_1.75 = out_18.1$proportion_1.75$type_trip$length$iss$iss,
               N_2.00 = out_18.1$proportion_2$type_trip$length$iss$iss) 

df2 = melt.data.table(df, id.vars = "year", variable.name = "scenario", value.name = "ISS")

df2 %>% 
  tidytable::mutate(ISS.diff = (df2$ISS[df2$scenario=="N_1.00"]) - ISS,
                    ISS.error = (ISS - df2$ISS[df2$scenario=="N_1.00"])/df2$ISS[df2$scenario=="N_1.00"],
                    type = "trip",
                    .by = scenario) -> df3.1

# Haul
df = tidytable(year = year,
               N_0.25 = out_18.1$proportion_0.25$type_haul$length$iss$iss,
               N_0.50 = out_18.1$proportion_0.5$type_haul$length$iss$iss,
               N_0.75 = out_18.1$proportion_0.75$type_haul$length$iss$iss,
               N_1.00 = out_1.4$length$iss$iss,
               N_1.25 = out_18.1$proportion_1.25$type_haul$length$iss$iss,
               N_1.50 = out_18.1$proportion_1.5$type_haul$length$iss$iss,
               N_1.75 = out_18.1$proportion_1.75$type_haul$length$iss$iss,
               N_2.00 = out_18.1$proportion_2$type_haul$length$iss$iss) 

df2 = melt.data.table(df, id.vars = "year", variable.name = "scenario", value.name = "ISS")

df2 %>% 
  tidytable::mutate(ISS.diff = (df2$ISS[df2$scenario=="N_1.00"]) - ISS,
                    ISS.error = (ISS - df2$ISS[df2$scenario=="N_1.00"])/df2$ISS[df2$scenario=="N_1.00"],
                    type = "haul",
                    .by = scenario) -> df3.2

df3.1 %>% 
  tidytable::bind_rows(df3.2) -> df4


df4 %>% 
  ggplot(aes(x = scenario, y = ISS.error*100)) +
  geom_boxplot(aes(fill = type)) +
  labs(x = "Proportional Change", y = "ISSB % Difference") +
  theme_classic() +
  theme(legend.position = c(0.5, 0.9)) +
  geom_hline(yintercept = -10, linetype = "dashed", color = "black") +
  geom_hline(yintercept = 10, linetype = "dashed", color = "black") +
  scale_y_continuous(breaks = seq(-100, 120, by = 10), limits = c(-100, 120)) +
  scale_x_discrete(labels = c("0.25", "0.50", "0.75", "1.00", "1.25", "1.50", "1.75", "2.00"))


```




### Boxplots Together 1999-2023
```{r}

df4 %>%  
  tidytable::filter(year %in% 1999:2023) -> df4.2



df4.2 %>% 
  ggplot(aes(x = scenario, y = ISS.error*100)) +
  geom_boxplot(aes(fill = type)) +
  labs(x = "Scenario", y = "ISSB % Error") +
  theme_classic() +
  theme(legend.position = c(0.5, 0.9)) +
  geom_hline(yintercept = -10, linetype = "dashed", color = "black") +
  geom_hline(yintercept = 10, linetype = "dashed", color = "black") +
  scale_y_continuous(breaks = seq(-100, 120, by = 10), limits = c(-100, 120))

```







