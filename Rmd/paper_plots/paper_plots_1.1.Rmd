---
title: "Paper Plots V1"
author: "Brett Stacy"
date: "2024-11-25"
output: pdf_document
editor_options: 
  chunk_output_type: console
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, warning = F, message = F, results = "hide", fig.width = 8.5, fig.height = 5, dpi = 600)
library(tidytable)
library(data.table)
library(reshape2)
library(ggplot2)
library(knitr)
library(stringr)
library(patchwork)
opts_knit$set(eval.after = "fig.cap")
options(scipen = 5)
```


# Introduction
Plots for paper:

1. Time series of new ISS vs old. Accompanied by number of hauls, nominal sample size, and possibly RSS boxplots. RSS boxplots may help justify focusing in on 20 sample size meidan for later plots to get an apples to apples, granular test of impact of sample size and expansion complexity.

2. ISS full, ISS without expansion, ISS without sampling strata, ISS without either. 

3. 3x3 grid: sample size 10, 20, 30 fixed X expansion none, haul only, haul+month. With sampling strata.

3.supp.1: same as above but without sampling strata. 
3.supp.2: same as above but without bootstrapping trip. 
3.supp.3: same as above but without either. 


## Plot 1.1
```{r}
out_1.1 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_1.1_ISS_100iters_output_2024-11-25.RDS")

out_1.2 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_1.2_ISS_1iters_output_2025-01-10.RDS")

out_1.3 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_1.3_ISS_100iters_output_2025-01-22.RDS")

out_1.4 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_1.4_ISS_1000iters_output_2025-01-23.RDS")

out_2.1 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_2.2_ISS_500iters_output_2025-01-28.RDS")

out_3.1 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_3.1_ISS_100iters_output_2024-11-26.RDS")

out_4.1 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_4.2_ISS_500iters_output_2025-01-28.RDS")

out_5.1 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_5.2_ISS_500iters_output_2025-01-27.RDS")

out_6.1 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_6.1_ISS_100iters_output_2024-11-26.RDS")
out_7.1 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_7.1_ISS_100iters_output_2024-11-26.RDS")
out_8.1 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_8.1_ISS_100iters_output_2024-11-26.RDS")
out_9.1 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_9.2_ISS_500iters_output_2025-01-27.RDS")
out_10.1 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_10.1_ISS_100iters_output_2024-12-04.RDS")
out_11.1 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_11.1_ISS_100iters_output_2024-12-04.RDS")
out_12.1 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_12.1_ISS_100iters_output_2024-12-10.RDS")
out_13.1 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_13.1_ISS_100iters_output_2024-12-10.RDS")
out_14.1 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_14.1_ISS_100iters_output_2024-12-10.RDS")
out_15.1 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_15.1_ISS_100iters_output_2024-12-10.RDS")
out_16.1 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_16.1_ISS_100iters_output_2024-12-11.RDS")
out_17.1 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_17.1_ISS_100iters_output_2024-12-11.RDS")

assessment_2023_iss = tidytable(year = 1977:2023,
                                iss = c(27,
                                45,
                                54,
                                54,
                                63,
                                31,
                                117,
                                140,
                                211,
                                216,
                                396,
                                401,
                                185,
                                189,
                                1565,
                                1543,
                                913,
                                1435,
                                1561,
                                2020,
                                2142,
                                2046,
                                2722,
                                2960,
                                3140,
                                3446,
                                4301,
                                3608,
                                3455,
                                2694,
                                2115,
                                2502,
                                2218,
                                1975,
                                2596,
                                2776,
                                3293,
                                3604,
                                3324,
                                2821,
                                2469,
                                1899,
                                1367,
                                1048,
                                859,
                                1160,
                                706))
```


### baseISS with assessment ISS

```{r}
par(mfrow = c(1,1), mar = c(1.5, 3.1, 0, .5), mgp = c(2, .6, 0))
plot(out_1.1$length$iss$YEAR, out_1.1$length$iss$iss, type = "l", ylab = "ISS", xlab = "year", cex.lab = 1.3, ylim = c(0, max(out_1.1$length$iss$iss)*1.1), col = "blue") 
lines(assessment_2023_iss$year, assessment_2023_iss$iss, col = "black")
legend("topleft", lty = c(1,1), col = c("black", "blue"), legend = c("2023 assessment", "baseISS"))




```




### All together 4 panel

```{r, fig.height=8}
df = data.frame(rss = out_1.1$length$rss$rss, year = as.factor(out_1.1$length$rss$YEAR))



# par(mfrow = c(4,1), mar = c(0,0,0,0), oma = c(2, 4, 2, .5), mgp = c(2, .6, 0))
par(mfrow = c(4,1), mar = c(1.5, 3.1, 0, .5), mgp = c(2, .6, 0))
plot(out_1.1$length$iss$YEAR, out_1.1$length$iss$iss, type = "l", ylab = "ISS", xaxt = "n") 
lines(assessment_2023_iss$year, assessment_2023_iss$iss, col = "blue")
legend("topleft", lty = c(1,1), col = c("black", "blue"), legend = c("2023 assessment", "baseISS"))


plot(out_1.1$length$iss$YEAR, out_1.1$length$iss$nhls, type = "l", ylab = "number of hauls", xlab = "", col = "black", cex.lab = 1.3, xaxt = "n")

plot(out_1.1$length$iss$YEAR, out_1.1$length$iss$nss, type = "l", ylab = "nominal sample size", xlab = "", cex.lab = 1.3, xaxt = "n") 




plot(df$year, df$rss, ylim = c(0, 20000), ylab = "RSS", cex.lab = 1.3, xlab = "year")

```



### All together 3 panel

```{r, fig.height=8}
df = data.frame(rss = out_1.1$length$rss$rss, year = as.factor(out_1.1$length$rss$YEAR))



# par(mfrow = c(4,1), mar = c(0,0,0,0), oma = c(2, 4, 2, .5), mgp = c(2, .6, 0))
# par(mfrow = c(3,1), mar = c(1.5, 3.1, 0, .5), mgp = c(2, .6, 0))
par(mfrow = c(3,1), mar = c(0,3.1,0,0), oma = c(2, 0, 2, .5), mgp = c(2, .6, 0))
plot(out_1.1$length$iss$YEAR, out_1.1$length$iss$iss, type = "l", ylab = "ISS", xaxt = "n", ylim = c(0, 15000)) 
lines(assessment_2023_iss$year, assessment_2023_iss$iss, col = "blue")
lines(out_1.1$length$iss$YEAR, out_1.1$length$iss$nhls, col = "red")
legend("topleft", lty = c(1,1,1), col = c("black", "blue", "red"), legend = c("ISSB", "ISSA", "number of hauls"))




plot(out_1.1$length$iss$YEAR, out_1.1$length$iss$nss, type = "l", ylab = "nominal sample size", xlab = "", cex.lab = 1.3, xaxt = "n") 




plot(df$year, df$rss, ylim = c(0, 20000), ylab = "RSS", cex.lab = 1.3)


```



### * All together 2 panel 

```{r, fig.height=6}
df = data.frame(rss = out_1.4$length$rss$rss, year = as.factor(out_1.4$length$rss$YEAR))



# par(mfrow = c(4,1), mar = c(0,0,0,0), oma = c(2, 4, 2, .5), mgp = c(2, .6, 0))
# par(mfrow = c(3,1), mar = c(1.5, 3.1, 0, .5), mgp = c(2, .6, 0))
par(mfrow = c(2,1), mar = c(0,3.1,0,0), oma = c(2, 0, 2, .5), mgp = c(2, .6, 0))
plot(out_1.4$length$iss$YEAR, out_1.4$length$iss$iss, type = "l", ylab = "ISS", xaxt = "n", ylim = c(0, 15000), cex.lab = 1.3) 
lines(assessment_2023_iss$year, assessment_2023_iss$iss, col = "blue")
lines(out_1.4$length$iss$YEAR, out_1.4$length$iss$nhls, col = "red")
legend("topleft", lty = c(1,1,1), col = c("black", "blue", "red"), legend = c("ISSB", "ISSA", "number of hauls"))




plot(out_1.4$length$iss$YEAR, out_1.4$length$iss$nss, type = "l", ylab = "Nominal Sample Size", xlab = "Year", cex.lab = 1.3) 





```




### All together TRIPS TOO 4 panel

```{r, fig.height=8}
df = data.frame(rss = out_1.1$length$rss$rss, year = as.factor(out_1.1$length$rss$YEAR))



# par(mfrow = c(4,1), mar = c(0,0,0,0), oma = c(2, 4, 2, .5), mgp = c(2, .6, 0))
par(mfrow = c(4,1), mar = c(1.5, 3.1, 0, .5), mgp = c(2, .6, 0))
plot(out_1.1$length$iss$YEAR, out_1.1$length$iss$iss, type = "l", ylab = "ISS", xaxt = "n") 
lines(assessment_2023_iss$year, assessment_2023_iss$iss, col = "blue")
legend("topleft", lty = c(1,1), col = c("black", "blue"), legend = c("2023 assessment", "baseISS"))


plot(out_1.1$length$iss$YEAR, out_1.1$length$iss$nhls, type = "l", ylab = "number of hauls", xlab = "", col = "black", cex.lab = 1.3, xaxt = "n")

plot(out_1.2$length$iss$YEAR, out_1.2$length$iss$ntps, ylim = c(0, 1000), ylab = "Number of Trips", type = "l", cex.lab = 1.3, xaxt = "n", xlab = "") 




plot(out_1.1$length$iss$YEAR, out_1.1$length$iss$nss, type = "l", ylab = "nominal sample size", cex.lab = 1.3, xlab = "year")

```




### All together TRIPS TOO 3 panel

```{r, fig.height=8}
df = data.frame(rss = out_1.1$length$rss$rss, year = as.factor(out_1.1$length$rss$YEAR))



# par(mfrow = c(4,1), mar = c(0,0,0,0), oma = c(2, 4, 2, .5), mgp = c(2, .6, 0))
# par(mfrow = c(3,1), mar = c(1.5, 3.1, 0, .5), mgp = c(2, .6, 0))
par(mfrow = c(3,1), mar = c(0,3.1,0,0), oma = c(2, 0, 2, .5), mgp = c(2, .6, 0))
plot(out_1.1$length$iss$YEAR, out_1.1$length$iss$iss, type = "l", ylab = "ISS", xaxt = "n", ylim = c(0, 15000)) 
lines(assessment_2023_iss$year, assessment_2023_iss$iss, col = "blue")
lines(out_1.1$length$iss$YEAR, out_1.1$length$iss$nhls, col = "red")
lines(out_1.2$length$iss$YEAR, out_1.2$length$iss$ntps, col = "green")
legend("topleft", lty = c(1,1,1), col = c("black", "blue", "red"), legend = c("ISSB", "ISSA", "number of hauls"))




plot(out_1.1$length$iss$YEAR, out_1.1$length$iss$nss, type = "l", ylab = "nominal sample size", xlab = "", cex.lab = 1.3, xaxt = "n") 




plot(df$year, df$rss, ylim = c(0, 20000), ylab = "RSS", cex.lab = 1.3)


```


### All together TRIPS TOO 4 panel sample rate by HAUL on bottom

```{r, fig.height=8}
df = data.frame(rss = out_1.1$length$rss$rss, year = as.factor(out_1.1$length$rss$YEAR))



# par(mfrow = c(4,1), mar = c(0,0,0,0), oma = c(2, 4, 2, .5), mgp = c(2, .6, 0))
# par(mfrow = c(3,1), mar = c(1.5, 3.1, 0, .5), mgp = c(2, .6, 0))
par(mfrow = c(4,1), mar = c(0,3.1,0,0), oma = c(2, 0, 2, .5), mgp = c(2, .6, 0))
plot(out_1.1$length$iss$YEAR, out_1.1$length$iss$iss, type = "l", ylab = "ISS", xaxt = "n", ylim = c(0, 15000)) 
lines(assessment_2023_iss$year, assessment_2023_iss$iss, col = "blue")
lines(out_1.1$length$iss$YEAR, out_1.1$length$iss$nhls, col = "red")
# lines(out_1.2$length$iss$YEAR, out_1.2$length$iss$ntps, col = "green")
legend("topleft", lty = c(1,1,1), col = c("black", "blue", "red"), legend = c("ISSB", "ISSA", "number of hauls"))




plot(out_1.4$length$iss$YEAR, out_1.4$length$iss$ntps, type = "l", ylab = "number of trips", xlab = "", cex.lab = 1.3, xaxt = "n")
plot(out_1.1$length$iss$YEAR, out_1.1$length$iss$nss, type = "l", ylab = "nominal sample size", xlab = "", cex.lab = 1.3, xaxt = "n")




# plot(df$year, df$rss, ylim = c(0, 20000), ylab = "RSS", cex.lab = 1.3)
out_1.4$length$freq_data_frame %>% 
  tidytable::summarise(samples_per_haul = unique(YAGMH_SFREQ), .by = c(YEAR, HAUL_JOIN)) %>% 
  tidytable::mutate(YEAR = as.factor(YEAR)) -> df.SpH

df.SpH %>% 
  tidytable::summarise(samples_per_haul_median = median(samples_per_haul), .by = c(YEAR)) %>% 
  tidytable::mutate(YEAR = as.numeric(as.character(YEAR))) -> df.SpH.median

# boxplot
# plot(df.SpH$YEAR, df.SpH$samples_per_haul, ylab = "Samples per Haul", cex.lab = 1.3, ylim = c(0, 400))

# median
plot(df.SpH.median$YEAR, df.SpH.median$samples_per_haul_median, type = "l", ylab = "Haul sample rate", cex.lab = 1.3)


```




\newpage

### 1999 and 2000 histograms
```{r, fig.height=8, fig.width=9}
# out_1.4$length$og_props %>% 
#   tidytable::filter(YEAR %in% 1999:2000) %>% 
#   tidytable::mutate(YEAR = as.factor(YEAR)) -> props.sub
# 
# ggplot(data = props.sub, aes(x = LENGTH, y = og_FREQ, colour = YEAR)) +
#   geom_line() +
#   geom_area(aes(fill = YEAR, group = YEAR), alpha = 0.5, position = "identity") +
#   theme_classic() +
#   theme(legend.position = c(0.8, 0.8)) +
#   scale_x_continuous(limits = c(25, 110)) +
#   labs(x = "Length", y = "Frequency")

out_1.4$length$og_props %>% 
  tidytable::filter(YEAR %in% 2003:2004) %>% 
  tidytable::mutate(Year = as.factor(YEAR)) -> props.sub

p1 = ggplot(data = props.sub, aes(x = LENGTH, y = og_FREQ, colour = Year)) +
  geom_line() +
  geom_area(aes(fill = Year, group = Year), alpha = 0.5, position = "identity") +
  theme_classic() +
  scale_x_continuous(limits = c(22, 108),
                     n.breaks = 9) +
  labs(x = "Length (cm)", y = "Frequency", tag = "A") +
  theme(legend.position = c(0.8, 0.8),
        plot.tag.position = c(0.1, 0.95),
        plot.tag = element_text(size = 14, face = "bold")) +
  scale_y_continuous(limits = c(0, .04), expand = c(0, 0))



# now do RSS
out_1.4$length$rss %>% 
  tidytable::filter(YEAR %in% 2003:2004) %>% 
  tidytable::mutate(Year = as.factor(YEAR)) -> props.sub

# violin plot
p2 = ggplot(props.sub, aes(x = rss, y = Year, fill = Year)) +
  geom_violin() +
  theme_classic() +
  stat_summary(fun.y = median, geom = "point", color = "black") +
  theme(legend.position = c(0.8, 0.8),
        plot.tag.position = c(0.1, 0.95),
        plot.tag = element_text(size = 14, face = "bold")) +
  labs(x = "RSS", y = "Year", tag = "B")
  

p1 / p2
```

\newpage

#### * Histograms

\newpage

```{r, fig.height=8, fig.width=9}
# 
# 
# ggplot(props.sub, aes(rss, fill = YEAR)) +
#   geom_histogram(binwidth = 500)
# 
# ggplot(props.sub, aes(rss, colour = YEAR)) +
#   geom_histogram(aes(fill = YEAR, group = YEAR), alpha = 0.5)
# 

 
p3 = ggplot(data = props.sub, aes(x = rss, colour = Year)) +
  geom_histogram(aes(fill = Year, group = Year), alpha = 0.5, position = "identity") +
  theme_classic() +
  theme(legend.position = c(0.8, 0.8),
        plot.tag.position = c(0.1, 0.95),
        plot.tag = element_text(size = 14, face = "bold")) +
  labs(x = "RSS", y = "Count", tag = "B") + 
  geom_point(data = props.sub %>% 
               tidytable::left_join(out_1.4$length$iss %>% 
                                      tidytable::select(YEAR, iss)) %>% 
               tidytable::summarise(x = unique(iss), .by = Year) %>% 
               # tidytable::summarise(x = median(rss), .by = Year) %>% 
               tidytable::mutate(y = c(9,9)), aes(x,y, fill = Year), shape = 25, size = 4, color = "black") +
  scale_y_continuous(limits = c(0, 300), expand = c(0, 0)) +
  # scale_x_continuous(n.breaks = 8)
  scale_x_continuous(breaks = seq(0, 35000, by = 2500),
                     labels = c(0, "", 5000, "", 10000, "", 15000, "", 20000, "", 25000, "", 30000, "", 35000))


p1 / p3

# +
#   scale_x_continuous(limits = c(22, 108)) +
#   labs(x = "Length", y = "Frequency")

```

The comparison shows that fish in 2003 were less similar in length compared to 2004. 2003 corresponds to a higher ISS even though the sample rate was the same and the number of hauls and nominal sample size were comparable. More of the fish sampled in 2003 were required for characterizing the underlying multinomial sampling distribution compared to 2004 because more lengths were represented at a higher rate in 2003 (shorter, wider distribution). This is reflected in the RSS (ref figure).

### Simulate Multinomials
```{r}


# rmultinom(1, size = 20, prob = out_1.4$length$og_props[YEAR==2003, c(og_FREQ)])[,1] %>% 
#   hist()

multinom_var = function(n, p) n*p*(1-p)

multinom_var(30, c(.3,.35)) %>% sum()
multinom_var(60, c(.3,.35)) %>% sum()

```




### Plot new number of hauls vs old

```{r, eval=F}

plot(out_1.1$length$iss$YEAR, out_1.1$length$iss$nhls, col = "red")
lines(out_1.4$length$iss$YEAR, out_1.4$length$iss$nhls, col = "blue")

plot(out_1.1$length$iss$YEAR, out_1.1$length$iss$nss, col = "red")
lines(out_1.4$length$iss$YEAR, out_1.4$length$iss$nss, col = "blue")

plot(out_1.2$length$iss$YEAR, out_1.2$length$iss$ntps, col = "red")
lines(out_1.4$length$iss$YEAR, out_1.4$length$iss$ntps, col = "blue")

out_1.2$length$iss$ntps-out_1.4$length$iss$ntps


```



### 



#### Inspect R-squared
Fit models to number of hauls.

```{r}
# baseISS ~ # hauls
fit1 = lm(out_1.1$length$iss$iss ~ out_1.1$length$iss$nhls)
summary(fit1)

# assessment ISS ~ # hauls
fit2 = lm(assessment_2023_iss$iss ~ out_1.1$length$iss$nhls)
summary(fit2)

# baseISS ~ assessment ISS
fit3 = lm(out_1.1$length$iss$iss ~ assessment_2023_iss$iss)
summary(fit3)

```






## Plot 2.1 
Deconstruct the contributors to baseISS


### All together 1

Subtracting things from baseISS

```{r, fig.height=8}

# par(mfrow = c(4,1), mar = c(0,0,0,0), oma = c(2, 4, 2, .5), mgp = c(2, .6, 0))
par(mfrow = c(5,1), mar = c(1.5, 3.1, 0, .5), mgp = c(2, .6, 0))
plot(out_1.1$length$iss$YEAR, out_1.1$length$iss$iss, type = "l", ylab = "baseISS", xaxt = "n") 
plot(out_2.1$length$iss$YEAR, out_2.1$length$iss$iss, type = "l", ylab = "baseISS - E", xaxt = "n") 
plot(out_3.1$length$iss$YEAR, out_3.1$length$iss$iss, type = "l", ylab = "baseISS - SS", xaxt = "n") 
plot(out_4.1$length$iss$YEAR, out_4.1$length$iss$iss, type = "l", ylab = "baseISS - (E,SS)", xaxt = "n") 
plot(out_5.1$length$iss$YEAR, out_5.1$length$iss$iss, type = "l", ylab = "baseISS - (E,SS,Bs)", cex.lab = 1.3, xlab = "year") 
```



### All together 2

Adding things to baseISS

```{r, fig.height=6}
par(mfrow = c(1,1))

plot(out_5.1$length$iss$YEAR, out_5.1$length$iss$iss, type = "l", ylab = "ISS", cex.lab = 1.3, col = "black")
lines(out_6.1$length$iss$YEAR, out_6.1$length$iss$iss, type = "l", col = "blue") 
lines(out_7.1$length$iss$YEAR, out_7.1$length$iss$iss, type = "l", col = "orange") 
lines(out_8.1$length$iss$YEAR, out_8.1$length$iss$iss, type = "l", col = "green") 
lines(out_1.1$length$iss$YEAR, out_1.1$length$iss$iss, type = "l", col = "red") 



legend("topleft", legend = c("-E,SS,Bs", "-SS,Bs", "-Bs", "-SS", "-0"), lty = c(1,1,1,1,1), col = c("black", "blue", "orange", "green", "red"))
```



#### sub range 1
```{r, fig.height=6}
sub_range = out_5.1$length$iss$YEAR %in% 1999:2023

par(mfrow = c(1,1))
plot(out_5.1$length$iss$YEAR[sub_range], out_5.1$length$iss$iss[sub_range], type = "l", ylab = "ISS", cex.lab = 1.3, col = "black", ylim = c(0, 25000))
lines(out_6.1$length$iss$YEAR[sub_range], out_6.1$length$iss$iss[sub_range], type = "l", col = "blue") 
lines(out_7.1$length$iss$YEAR[sub_range], out_7.1$length$iss$iss[sub_range], type = "l", col = "orange") 
lines(out_8.1$length$iss$YEAR[sub_range], out_8.1$length$iss$iss[sub_range], type = "l", col = "green") 
lines(out_1.1$length$iss$YEAR[sub_range], out_1.1$length$iss$iss[sub_range], type = "l", col = "red") 



legend("topright", legend = c("boot length", "boot length and expand", "boot length, expand, sampling strata weighting", "boot length, expand, boot trip+haul", "full"), lty = c(1,1,1,1,1), col = c("black", "blue", "orange", "green", "red"))
```



#### * reorder long

\newpage

```{r, fig.height=5.5}
sub_range = out_5.1$length$iss$YEAR %in% 1977:2023

par(mfrow = c(1,1))
plot(out_5.1$length$iss$YEAR[sub_range], out_5.1$length$iss$iss[sub_range], type = "l", ylab = "ISSB", cex.lab = 1.3, col = "black", ylim = c(0, 25000), xlab = "Year")
lines(out_9.1$length$iss$YEAR[sub_range], out_9.1$length$iss$iss[sub_range], type = "l", col = "blue") 
lines(out_4.1$length$iss$YEAR[sub_range], out_4.1$length$iss$iss[sub_range], type = "l", col = "orange") 
lines(out_2.1$length$iss$YEAR[sub_range], out_2.1$length$iss$iss[sub_range], type = "l", col = "green")
# lines(out_8.1$length$iss$YEAR[sub_range], out_8.1$length$iss$iss[sub_range], type = "l", col = "green") 
lines(out_1.4$length$iss$YEAR[sub_range], out_1.4$length$iss$iss[sub_range], type = "l", col = "red")



legend("topleft", legend = c("boot length", "boot length + boot haul", "boot all", "boot all + sampling strata weighting", "full"), lty = c(1,1,1,1,1), col = c("black", "blue", "orange", "green", "red"), bty = "n")
```

\newpage



##### * Inspect 2000, 2001 for expansion drop
```{r}
out_1.4$length$freq_data_frame %>% 
  tidytable::filter(YEAR %in% 2000:2001) %>% 
  tidytable::summarise(YAGMH = unique(YAGMH_SNUM), .by = YEAR) %>% 
  tidytable::mutate(YEAR = as.factor(YEAR)) -> temp1


ggplot(data = temp1, aes(x = YAGMH, colour = YEAR)) +
  geom_histogram(aes(fill = YEAR, group = YEAR), alpha = 0.5, position = "identity") +
  theme_classic()



out_1.4$length$freq_data_frame %>% 
  tidytable::filter(YEAR %in% 2000:2001) %>% 
  tidytable::summarise(YAGM = unique(YAGM_SNUM), .by = YEAR) %>% 
  tidytable::mutate(YEAR = as.factor(YEAR)) -> temp2


ggplot(data = temp2, aes(x = YAGM, colour = YEAR)) +
  geom_histogram(aes(fill = YEAR, group = YEAR), alpha = 0.5, position = "identity") +
  theme_classic()



# inspect huge weighted YAGM over 30,000,000
out_1.4$length$freq_data_frame %>% 
  tidytable::filter(YAGM_SNUM>10000000, YEAR%in%2000:2001) %>% 
  tidytable::mutate(Year = as.factor(YEAR)) -> temp3

temp3 %>% 
  ggplot(aes(x = LENGTH, colour = Year)) +
  geom_histogram(aes(fill = Year, group = Year), alpha = 0.5, position = "identity") +
  theme_classic() +
  scale_x_continuous(limits = c(30, 115))


# maybe gear is responsible: check big AGM category to see if many more fish were caught with trawl net in 2000?




# wait, it should be the combined weight right? so which WEIGHT is that from the expansion? Is it saved in the output?



```





#### reorder short

\newpage

```{r, fig.height=6}
sub_range = out_5.1$length$iss$YEAR %in% 1999:2023

par(mfrow = c(1,1))
plot(out_5.1$length$iss$YEAR[sub_range], out_5.1$length$iss$iss[sub_range], type = "l", ylab = "ISSB", cex.lab = 1.3, col = "black", ylim = c(0, 25000), xlab = "")
lines(out_9.1$length$iss$YEAR[sub_range], out_9.1$length$iss$iss[sub_range], type = "l", col = "blue") 
lines(out_4.1$length$iss$YEAR[sub_range], out_4.1$length$iss$iss[sub_range], type = "l", col = "orange") 
lines(out_2.1$length$iss$YEAR[sub_range], out_2.1$length$iss$iss[sub_range], type = "l", col = "green")
# lines(out_8.1$length$iss$YEAR[sub_range], out_8.1$length$iss$iss[sub_range], type = "l", col = "green") 
lines(out_1.1$length$iss$YEAR[sub_range], out_1.1$length$iss$iss[sub_range], type = "l", col = "red")



legend("topright", legend = c("boot length", "boot length + boot haul", "boot all", "boot all + sampling strata weighting", "full"), lty = c(1,1,1,1,1), col = c("black", "blue", "orange", "green", "red"))
```


\newpage

#### reorder short with half trips and half hauls
```{r, fig.height=6}
sub_range = out_5.1$length$iss$YEAR %in% 1998:2023

par(mfrow = c(1,1))
plot(out_5.1$length$iss$YEAR[sub_range], out_5.1$length$iss$iss[sub_range], type = "l", ylab = "ISS", cex.lab = 1.3, col = "black", ylim = c(0, 25000), xlab = "Year")
lines(out_9.1$length$iss$YEAR[sub_range], out_9.1$length$iss$iss[sub_range], type = "l", col = "blue") 
lines(out_4.1$length$iss$YEAR[sub_range], out_4.1$length$iss$iss[sub_range], type = "l", col = "orange") 
lines(out_12.1$length$iss$YEAR[sub_range], out_12.1$length$iss$iss[sub_range], type = "l", col = "purple")
lines(out_13.1$length$iss$YEAR[sub_range], out_13.1$length$iss$iss[sub_range], type = "l", col = "brown")
lines(out_2.1$length$iss$YEAR[sub_range], out_2.1$length$iss$iss[sub_range], type = "l", col = "green")
lines(out_1.1$length$iss$YEAR[sub_range], out_1.1$length$iss$iss[sub_range], type = "l", col = "red")



legend("topright", legend = c("boot length", "boot length, haul", "boot all", "boot all, half trips", "boot all, half hauls", "boot all, sampling strata weighting", "full"), lty = c(1,1,1,1,1,1,1), col = c("black", "blue", "orange","purple", "brown", "green", "red"))
```




#### reorder short 2
```{r, fig.height=6}
sub_range = out_5.1$length$iss$YEAR %in% 1998:2023

par(mfrow = c(1,1))
plot(out_10.1$length$iss$YEAR[sub_range], out_10.1$length$iss$iss[sub_range], type = "l", ylab = "ISS", cex.lab = 1.3, col = "black", ylim = c(0, 25000), xlab = "Year")
lines(out_11.1$length$iss$YEAR[sub_range], out_11.1$length$iss$iss[sub_range], type = "l", col = "blue") 

lines(out_1.1$length$iss$YEAR[sub_range], out_1.1$length$iss$iss[sub_range], type = "l", col = "red")



legend("topright", legend = c("boot.length", "boot.length + boot.haul", "boot.length + boot.haul + boot.trip"), lty = c(1,1,1), col = c("black", "blue", "red"))
```


#### Full, half trip, half haul
```{r, fig.height=6}
sub_range = out_5.1$length$iss$YEAR %in% 1998:2023

par(mfrow = c(1,1))
plot(out_1.1$length$iss$YEAR[sub_range], out_1.1$length$iss$iss[sub_range], type = "l", ylab = "ISS", cex.lab = 1.3, col = "black", ylim = c(0, 25000), xlab = "Year")
lines(out_14.1$length$iss$YEAR[sub_range], out_14.1$length$iss$iss[sub_range], type = "l", col = "blue") 

lines(out_15.1$length$iss$YEAR[sub_range], out_15.1$length$iss$iss[sub_range], type = "l", col = "red")



legend("topright", legend = c("Full", "Half Trip", "Half Haul"), lty = c(1,1,1), col = c("black", "blue", "red"))
```


#### Full, 1.5 trip, 1.5 haul
```{r, fig.height=6}
sub_range = out_5.1$length$iss$YEAR %in% 1998:2023

par(mfrow = c(1,1))
plot(out_1.1$length$iss$YEAR[sub_range], out_1.1$length$iss$iss[sub_range], type = "l", ylab = "ISS", cex.lab = 1.3, col = "black", ylim = c(0, 25000), xlab = "Year")
lines(out_16.1$length$iss$YEAR[sub_range], out_16.1$length$iss$iss[sub_range], type = "l", col = "blue") 

lines(out_17.1$length$iss$YEAR[sub_range], out_17.1$length$iss$iss[sub_range], type = "l", col = "red")



legend("topright", legend = c("Full", "1.5 Trip", "1.5 Haul"), lty = c(1,1,1), col = c("black", "blue", "red"))
```





## Plot 7x2 Grid Haul and Trip numbers



### Trip Change
```{r}

# out_18.1 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_18.1_ISS_200_iters_2024-12-12.RDS")
out_18.1 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_18.2_ISS_200_iters_2025-02-01.RDS")

year = out_18.1$proportion_0.25$type_trip$length$iss$YEAR
proportion_global = c(0.25, 0.50, 0.75, 1.25, 1.50, 1.75, 2.00)
type_global = list("trip", "haul")
type_names_global = c("trip", "haul")

df = tidytable(year = year,
               N_0.25 = out_18.1$proportion_0.25$type_trip$length$iss$iss,
               N_0.50 = out_18.1$proportion_0.5$type_trip$length$iss$iss,
               N_0.75 = out_18.1$proportion_0.75$type_trip$length$iss$iss,
               N_1.00 = out_1.4$length$iss$iss,
               N_1.25 = out_18.1$proportion_1.25$type_trip$length$iss$iss,
               N_1.50 = out_18.1$proportion_1.5$type_trip$length$iss$iss,
               N_1.75 = out_18.1$proportion_1.75$type_trip$length$iss$iss,
               N_2.00 = out_18.1$proportion_2$type_trip$length$iss$iss) 

df2 = melt.data.table(df, id.vars = "year", variable.name = "scenario", value.name = "ISS")
df2.trip = df2



ggplot(data = df2, aes(x = year, y = ISS, group = scenario, colour = scenario)) +
  geom_line() +
  labs(x = "Year", y = "ISS") +
  geom_point() +
  ylim(0, 17000) +
  xlim(1998, 2023)



```

### Boxplots
REMEMBER! these are the full year range, may want to narrow it to recent range.
```{r}
df2 %>% 
  tidytable::mutate(ISS.diff = (df2$ISS[df2$scenario=="N_1.00"]) - ISS,
                    ISS.error = (ISS - df2$ISS[df2$scenario=="N_1.00"])/df2$ISS[df2$scenario=="N_1.00"],
                    type = "trip",
                    .by = scenario) -> df3.1

# plot(df3$scenario, df3$ISS.diff)
plot(df3.1$scenario, df3.1$ISS.error)
abline(h = c(-.1,.1), lty = "dashed")

```


### Haul Change
```{r}

# out_18.1 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_18.1_ISS_200_iters_2024-12-12.RDS")
out_18.1 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_18.2_ISS_200_iters_2025-02-01.RDS")

year = out_18.1$proportion_0.25$type_trip$length$iss$YEAR
proportion_global = c(0.25, 0.50, 0.75, 1.25, 1.50, 1.75, 2.00)
type_global = list("trip", "haul")
type_names_global = c("trip", "haul")

df = tidytable(year = year,
               N_0.25 = out_18.1$proportion_0.25$type_haul$length$iss$iss,
               N_0.50 = out_18.1$proportion_0.5$type_haul$length$iss$iss,
               N_0.75 = out_18.1$proportion_0.75$type_haul$length$iss$iss,
               N_1.00 = out_1.4$length$iss$iss,
               N_1.25 = out_18.1$proportion_1.25$type_haul$length$iss$iss,
               N_1.50 = out_18.1$proportion_1.5$type_haul$length$iss$iss,
               N_1.75 = out_18.1$proportion_1.75$type_haul$length$iss$iss,
               N_2.00 = out_18.1$proportion_2$type_haul$length$iss$iss) 

df2 = melt.data.table(df, id.vars = "year", variable.name = "scenario", value.name = "ISS")
df2.haul = df2



ggplot(data = df2, aes(x = year, y = ISS, group = scenario, colour = scenario)) +
  geom_line() +
  labs(x = "Year", y = "ISS") +
  geom_point() +
  ylim(0, 17000) +
  xlim(1998, 2023)



```


### Boxplots Haul and Trip
```{r}
df2 %>% 
  tidytable::mutate(ISS.diff = (df2$ISS[df2$scenario=="N_1.00"]) - ISS,
                    ISS.error = (ISS - df2$ISS[df2$scenario=="N_1.00"])/df2$ISS[df2$scenario=="N_1.00"],
                    type = "haul",
                    .by = scenario) -> df3.2

# plot(df3$scenario, df3$ISS.diff)
plot(df3.2$scenario, df3.2$ISS.error)
abline(h = c(-.1,.1), lty = "dashed")

```


### * Boxplots Together 1977-2023
```{r, fig.width=8}

df3.1 %>% 
  tidytable::bind_rows(df3.2) -> df4


df4 %>% 
  ggplot(aes(x = scenario, y = ISS.error*100)) +
  geom_boxplot(aes(fill = type)) +
  labs(x = "Proportional Change", y = "ISSB % Difference") +
  theme_classic() +
  theme(legend.position = c(0.5, 0.9)) +
  geom_hline(yintercept = -10, linetype = "dashed", color = "black") +
  geom_hline(yintercept = 10, linetype = "dashed", color = "black") +
  scale_y_continuous(breaks = seq(-100, 120, by = 10), limits = c(-100, 120)) +
  scale_x_discrete(labels = c("0.25", "0.50", "0.75", "1.00", "1.25", "1.50", "1.75", "2.00"))



# Stats
df4 %>% filter(type=="trip", scenario=="N_0.25") %>% pull(ISS.error) %>% median
df4 %>% filter(type=="trip", scenario=="N_2.00") %>% pull(ISS.error) %>% median
df4 %>% filter(type=="haul", scenario=="N_0.25") %>% pull(ISS.error) %>% median
df4 %>% filter(type=="haul", scenario=="N_2.00") %>% pull(ISS.error) %>% median


```

### Boxplots Together 1999-2023
```{r}

df3.1 %>% 
  tidytable::bind_rows(df3.2) %>% 
  tidytable::filter(year %in% 1999:2023) -> df4



df4 %>% 
  ggplot(aes(x = scenario, y = ISS.error*100)) +
  geom_boxplot(aes(fill = type)) +
  labs(x = "Scenario", y = "ISSB % Error") +
  theme_classic() +
  theme(legend.position = c(0.5, 0.9)) +
  geom_hline(yintercept = -10, linetype = "dashed", color = "black") +
  geom_hline(yintercept = 10, linetype = "dashed", color = "black") +
  scale_y_continuous(breaks = seq(-100, 120, by = 10), limits = c(-100, 120))

```



#### Boxplots Together 1999-2023 TAKE TWO. fix mistake? NO ITS THE SAME AS ABOVE
```{r}
df2.trip %>% 
  tidytable::filter(year %in% 1999:2023) -> df2.trip
df2.trip %>% 
  tidytable::mutate(ISS.diff = (df2.trip$ISS[df2.trip$scenario=="N_1.00"]) - ISS,
                    ISS.error = (ISS - df2.trip$ISS[df2.trip$scenario=="N_1.00"])/df2.trip$ISS[df2.trip$scenario=="N_1.00"],
                    type = "trip",
                    .by = scenario) -> df3.1.trip
df2.haul %>% 
  tidytable::filter(year %in% 1999:2023) -> df2.haul
df2.haul %>% 
  tidytable::mutate(ISS.diff = (df2.haul$ISS[df2.haul$scenario=="N_1.00"]) - ISS,
                    ISS.error = (ISS - df2.haul$ISS[df2.haul$scenario=="N_1.00"])/df2.haul$ISS[df2.haul$scenario=="N_1.00"],
                    type = "haul",
                    .by = scenario) -> df3.2.haul
df3.1.trip %>% 
  tidytable::bind_rows(df3.2.haul) -> df4.2



df4.2 %>% 
  ggplot(aes(x = scenario, y = ISS.error*100)) +
  geom_boxplot(aes(fill = type)) +
  labs(x = "Scenario", y = "ISSB % Error") +
  theme_classic() +
  theme(legend.position = c(0.5, 0.9)) +
  geom_hline(yintercept = -10, linetype = "dashed", color = "black") +
  geom_hline(yintercept = 10, linetype = "dashed", color = "black") +
  scale_y_continuous(breaks = seq(-100, 120, by = 10), limits = c(-100, 120))


```


### Boxplots samples

### Validate N=20 assumption
is assuming n=20 when the median is 20 for 1999-2023 valid to make a valid control? How well do they match?
```{r}

out_22.1 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_22.1_ISS_200_iters_2024-12-25.RDS")

plot(out_22.1$samples_20$expansion_haul_month_numbers$length$iss$iss, ylim = c(0, 13000))
lines(out_1.1$length$iss$iss[out_1.1$length$iss$YEAR %in% 1999:2023], col = "blue")




```



### Boxplots Together 1977-2023
```{r}

out_21.1 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_21.1_ISS_200_iters_2024-12-23.RDS")

year = out_21.1$samples_1$length$iss$YEAR
proportion_global = c(0.25, 0.50, 0.75, 1.25, 1.50, 1.75, 2.00)
type_global = list("trip", "haul")
type_names_global = c("trip", "haul")

df = tidytable(year = year,
               N_1 = out_21.1$samples_1$length$iss$iss,
               N_5 = out_21.1$samples_5$length$iss$iss,
               N_10 = out_21.1$samples_10$length$iss$iss,
               N_15 = out_21.1$samples_15$length$iss$iss,
               N_20 = out_21.1$samples_20$length$iss$iss,
               N_25 = out_21.1$samples_25$length$iss$iss,
               N_30 = out_21.1$samples_30$length$iss$iss,
               N_35 = out_21.1$samples_35$length$iss$iss)
              

df2 = melt.data.table(df, id.vars = "year", variable.name = "scenario", value.name = "ISS")



ggplot(data = df2, aes(x = year, y = ISS, group = scenario, colour = scenario)) +
  geom_line() +
  labs(x = "Year", y = "ISS") +
  geom_point() +
  ylim(0, 17000)






df2 %>% 
  tidytable::mutate(ISS.diff = (df2$ISS[df2$scenario=="N_20"]) - ISS,
                    ISS.error = (ISS - df2$ISS[df2$scenario=="N_20"])/df2$ISS[df2$scenario=="N_20"],
                    type = "sample",
                    .by = scenario) %>% 
  tidytable::filter(year %in% 1999:2023)-> df3.2

# plot(df3$scenario, df3$ISS.diff)
plot(df3.2$scenario, df3.2$ISS.error)
abline(h = c(-.1,.1), lty = "dashed")





df3.2 %>% 
  ggplot(aes(x = scenario, y = ISS.error*100)) +
  geom_boxplot(aes(fill = type)) +
  labs(x = "Scenario", y = "ISSB % Error") +
  theme_classic() +
  theme(legend.position = c(0.5, 0.2)) +
  geom_hline(yintercept = -10, linetype = "dashed", color = "black") +
  geom_hline(yintercept = 10, linetype = "dashed", color = "black") +
  scale_y_continuous(breaks = seq(-100, 120, by = 10))



```




### * Samples VS Expantion. Boxplots Together 1999-2023
```{r, fig.width=8}

# out_22.1 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_22.1_ISS_200_iters_2024-12-25.RDS")
out_22.1 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_22.2_ISS_500_iters_2025-02-01.RDS")

year = out_22.1$samples_1$expansion_NULL$length$iss$YEAR
samples_global = c(1, 5, 10, 15, 20, 25, 30, 35)
expansion_global = list(NULL, "haul_numbers", c("haul_numbers", "month_numbers"))
expansion_names_global = c("NULL", "haul_numbers", c("haul_month_numbers"))


df = tidytable(year = year,
               N1_Enone = out_22.1$samples_1$expansion_NULL$length$iss$iss,
               N5_Enone = out_22.1$samples_5$expansion_NULL$length$iss$iss,
               N10_Enone = out_22.1$samples_10$expansion_NULL$length$iss$iss,
               N15_Enone = out_22.1$samples_15$expansion_NULL$length$iss$iss,
               N20_Enone = out_22.1$samples_20$expansion_NULL$length$iss$iss,
               N25_Enone = out_22.1$samples_25$expansion_NULL$length$iss$iss,
               N30_Enone = out_22.1$samples_30$expansion_NULL$length$iss$iss,
               N35_Enone = out_22.1$samples_35$expansion_NULL$length$iss$iss,
               N1_Emedium = out_22.1$samples_1$expansion_haul_numbers$length$iss$iss,
               N5_Emedium = out_22.1$samples_5$expansion_haul_numbers$length$iss$iss,
               N10_Emedium = out_22.1$samples_10$expansion_haul_numbers$length$iss$iss,
               N15_Emedium = out_22.1$samples_15$expansion_haul_numbers$length$iss$iss,
               N20_Emedium = out_22.1$samples_20$expansion_haul_numbers$length$iss$iss,
               N25_Emedium = out_22.1$samples_25$expansion_haul_numbers$length$iss$iss,
               N30_Emedium = out_22.1$samples_30$expansion_haul_numbers$length$iss$iss,
               N35_Emedium = out_22.1$samples_35$expansion_haul_numbers$length$iss$iss,
               N1_Efull = out_22.1$samples_1$expansion_haul_month_numbers$length$iss$iss,
               N5_Efull = out_22.1$samples_5$expansion_haul_month_numbers$length$iss$iss,
               N10_Efull = out_22.1$samples_10$expansion_haul_month_numbers$length$iss$iss,
               N15_Efull = out_22.1$samples_15$expansion_haul_month_numbers$length$iss$iss,
               N20_Efull = out_22.1$samples_20$expansion_haul_month_numbers$length$iss$iss,
               N25_Efull = out_22.1$samples_25$expansion_haul_month_numbers$length$iss$iss,
               N30_Efull = out_22.1$samples_30$expansion_haul_month_numbers$length$iss$iss,
               N35_Efull = out_22.1$samples_35$expansion_haul_month_numbers$length$iss$iss) 

df2 = melt.data.table(df, id.vars = "year", variable.name = "scenario", value.name = "ISS")

df2[grep("Enone", scenario)] %>% 
  tidytable::mutate(ISS.error = (ISS - df2$ISS[df2$scenario=="N20_Enone"])/df2$ISS[df2$scenario=="N20_Enone"],
                    type = "Enone",
                    .by = scenario) %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 1, end = -7)) -> df3.1

df2[grep("Emedium", scenario)] %>% 
  tidytable::mutate(ISS.error = (ISS - df2$ISS[df2$scenario=="N20_Emedium"])/df2$ISS[df2$scenario=="N20_Emedium"],
                    type = "Emedium",
                    .by = scenario) %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 1, end = -9)) -> df3.2

df2[grep("Efull", scenario)] %>% 
  tidytable::mutate(ISS.error = (ISS - df2$ISS[df2$scenario=="N20_Efull"])/df2$ISS[df2$scenario=="N20_Efull"],
                    type = "Efull",
                    .by = scenario) %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 1, end = -7)) -> df3.3

df3.1 %>% 
  tidytable::bind_rows(df3.2) %>% 
  tidytable::bind_rows(df3.3) %>% 
  tidytable::mutate(scenario = forcats::fct_inorder(scenario)) -> df4


df4 %>% 
  ggplot(aes(x = scenario, y = ISS.error*100)) +
  geom_boxplot(aes(fill = type)) +
  labs(x = "Samples per Haul", y = "ISSB % Difference") +
  theme_classic() +
  theme(legend.position = c(0.5, 0.2)) +
  geom_hline(yintercept = -10, linetype = "dashed", color = "black") +
  geom_hline(yintercept = 10, linetype = "dashed", color = "black") +
  scale_y_continuous(breaks = seq(-100, 120, by = 10)) +
  scale_x_discrete(labels = c("1", "5", "10", "15", "20", "25", "30", "35"))


# Stats
df4 %>% filter(type=="trip", scenario=="N_0.25") %>% pull(ISS.error) %>% median
df4 %>% filter(type=="trip", scenario=="N_2.00") %>% pull(ISS.error) %>% median
df4 %>% filter(type=="haul", scenario=="N_0.25") %>% pull(ISS.error) %>% median
df4 %>% filter(type=="haul", scenario=="N_2.00") %>% pull(ISS.error) %>% median


```




### Samples VS Expantion TAKE 2: relative to unbiased control. Boxplots Together 1999-2023
```{r, fig.width=8}

out_22.1 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_22.1_ISS_200_iters_2024-12-25.RDS")

year = out_22.1$samples_1$expansion_NULL$length$iss$YEAR
samples_global = c(1, 5, 10, 15, 20, 25, 30, 35)
expansion_global = list(NULL, "haul_numbers", c("haul_numbers", "month_numbers"))
expansion_names_global = c("NULL", "haul_numbers", c("haul_month_numbers"))


df = tidytable(year = year,
               N1_Enone = out_22.1$samples_1$expansion_NULL$length$iss$iss,
               N5_Enone = out_22.1$samples_5$expansion_NULL$length$iss$iss,
               N10_Enone = out_22.1$samples_10$expansion_NULL$length$iss$iss,
               N15_Enone = out_22.1$samples_15$expansion_NULL$length$iss$iss,
               N20_Enone = out_22.1$samples_20$expansion_NULL$length$iss$iss,
               N25_Enone = out_22.1$samples_25$expansion_NULL$length$iss$iss,
               N30_Enone = out_22.1$samples_30$expansion_NULL$length$iss$iss,
               N35_Enone = out_22.1$samples_35$expansion_NULL$length$iss$iss,
               N1_Emedium = out_22.1$samples_1$expansion_haul_numbers$length$iss$iss,
               N5_Emedium = out_22.1$samples_5$expansion_haul_numbers$length$iss$iss,
               N10_Emedium = out_22.1$samples_10$expansion_haul_numbers$length$iss$iss,
               N15_Emedium = out_22.1$samples_15$expansion_haul_numbers$length$iss$iss,
               N20_Emedium = out_22.1$samples_20$expansion_haul_numbers$length$iss$iss,
               N25_Emedium = out_22.1$samples_25$expansion_haul_numbers$length$iss$iss,
               N30_Emedium = out_22.1$samples_30$expansion_haul_numbers$length$iss$iss,
               N35_Emedium = out_22.1$samples_35$expansion_haul_numbers$length$iss$iss,
               N1_Efull = out_22.1$samples_1$expansion_haul_month_numbers$length$iss$iss,
               N5_Efull = out_22.1$samples_5$expansion_haul_month_numbers$length$iss$iss,
               N10_Efull = out_22.1$samples_10$expansion_haul_month_numbers$length$iss$iss,
               N15_Efull = out_22.1$samples_15$expansion_haul_month_numbers$length$iss$iss,
               N20_Efull = out_22.1$samples_20$expansion_haul_month_numbers$length$iss$iss,
               N25_Efull = out_22.1$samples_25$expansion_haul_month_numbers$length$iss$iss,
               N30_Efull = out_22.1$samples_30$expansion_haul_month_numbers$length$iss$iss,
               N35_Efull = out_22.1$samples_35$expansion_haul_month_numbers$length$iss$iss) 

df2 = melt.data.table(df, id.vars = "year", variable.name = "scenario", value.name = "ISS")




df2 %>% 
  tidytable::mutate(ISS.error = (ISS - df2$ISS[df2$scenario=="N20_Efull"])/df2$ISS[df2$scenario=="N20_Efull"],
                    .by = scenario)


df2[grep("Enone", scenario)] %>% 
  tidytable::mutate(ISS.error = (ISS - df2$ISS[df2$scenario=="N20_Efull"])/df2$ISS[df2$scenario=="N20_Efull"],
                    type = "Enone",
                    .by = scenario) %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 1, end = -7)) -> df3.1





df2[grep("Emedium", scenario)] %>% 
  tidytable::mutate(ISS.error = (ISS - df2$ISS[df2$scenario=="N20_Efull"])/df2$ISS[df2$scenario=="N20_Efull"],
                    type = "Emedium",
                    .by = scenario) %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 1, end = -9)) -> df3.2

df2[grep("Efull", scenario)] %>% 
  tidytable::mutate(ISS.error = (ISS - df2$ISS[df2$scenario=="N20_Efull"])/df2$ISS[df2$scenario=="N20_Efull"],
                    type = "Efull",
                    .by = scenario) %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 1, end = -7)) -> df3.3

df3.1 %>% 
  tidytable::bind_rows(df3.2) %>% 
  tidytable::bind_rows(df3.3) %>% 
  tidytable::mutate(scenario = forcats::fct_inorder(scenario)) -> df4


df4 %>% 
  ggplot(aes(x = scenario, y = ISS.error*100)) +
  geom_boxplot(aes(fill = type)) +
  labs(x = "Scenario", y = "ISSB % Error") +
  theme_classic() +
  theme(legend.position = c(0.5, 0.2)) +
  geom_hline(yintercept = -10, linetype = "dashed", color = "black") +
  geom_hline(yintercept = 10, linetype = "dashed", color = "black") +
  scale_y_continuous(breaks = seq(-100, 120, by = 10), limits = c(-100, 120))


# Stats
df4 %>% filter(type=="trip", scenario=="N_0.25") %>% pull(ISS.error) %>% median
df4 %>% filter(type=="trip", scenario=="N_2.00") %>% pull(ISS.error) %>% median
df4 %>% filter(type=="haul", scenario=="N_0.25") %>% pull(ISS.error) %>% median
df4 %>% filter(type=="haul", scenario=="N_2.00") %>% pull(ISS.error) %>% median


```



### Samples VS Haul. Boxplots Together 1999-2023
```{r, fig.width=8}

out_24.1 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_24.1_ISS_200_iters_2025-01-02.RDS")

year = out_24.1$samples_1$trip_0.25$length$iss$YEAR
samples_global = c(1, 5, 10, 15, 20, 25, 30, 35)
proportion_global = c(0.25, 0.50, 0.75, 1.25, 1.50, 1.75, 2.00)


df = tidytable(year = year,
               N1_H0.75 = out_24.1$samples_1$trip_0.75$length$iss$iss,
               N5_H0.75 = out_24.1$samples_5$trip_0.75$length$iss$iss,
               N10_H0.75 = out_24.1$samples_10$trip_0.75$length$iss$iss,
               N15_H0.75 = out_24.1$samples_15$trip_0.75$length$iss$iss,
               N20_H0.75 = out_24.1$samples_20$trip_0.75$length$iss$iss,
               N25_H0.75 = out_24.1$samples_25$trip_0.75$length$iss$iss,
               N30_H0.75 = out_24.1$samples_30$trip_0.75$length$iss$iss,
               N35_H0.75 = out_24.1$samples_35$trip_0.75$length$iss$iss,
               N1_H1.0 = out_22.1$samples_1$expansion_haul_month_numbers$length$iss$iss,
               N5_H1.0 = out_22.1$samples_5$expansion_haul_month_numbers$length$iss$iss,
               N10_H1.0 = out_22.1$samples_10$expansion_haul_month_numbers$length$iss$iss,
               N15_H1.0 = out_22.1$samples_15$expansion_haul_month_numbers$length$iss$iss,
               N20_H1.0 = out_22.1$samples_20$expansion_haul_month_numbers$length$iss$iss,
               N25_H1.0 = out_22.1$samples_25$expansion_haul_month_numbers$length$iss$iss,
               N30_H1.0 = out_22.1$samples_30$expansion_haul_month_numbers$length$iss$iss,
               N35_H1.0 = out_22.1$samples_35$expansion_haul_month_numbers$length$iss$iss,
               N1_H1.25 = out_24.1$samples_1$trip_1.25$length$iss$iss,
               N5_H1.25 = out_24.1$samples_5$trip_1.25$length$iss$iss,
               N10_H1.25 = out_24.1$samples_10$trip_1.25$length$iss$iss,
               N15_H1.25 = out_24.1$samples_15$trip_1.25$length$iss$iss,
               N20_H1.25 = out_24.1$samples_20$trip_1.25$length$iss$iss,
               N25_H1.25 = out_24.1$samples_25$trip_1.25$length$iss$iss,
               N30_H1.25 = out_24.1$samples_30$trip_1.25$length$iss$iss,
               N35_H1.25 = out_24.1$samples_35$trip_1.25$length$iss$iss) 

df2 = melt.data.table(df, id.vars = "year", variable.name = "scenario", value.name = "ISS")

df2[grep("H0.75", scenario)] %>% 
  tidytable::mutate(ISS.error = (ISS - df2$ISS[df2$scenario=="N20_H0.75"])/df2$ISS[df2$scenario=="N20_H0.75"],
                    type = "H0.75",
                    .by = scenario) %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 1, end = -7)) -> df3.1

df2[grep("H1.0", scenario)] %>% 
  tidytable::mutate(ISS.error = (ISS - df2$ISS[df2$scenario=="N20_H1.0"])/df2$ISS[df2$scenario=="N20_H1.0"],
                    type = "H1.0",
                    .by = scenario) %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 1, end = -6)) -> df3.2

df2[grep("H1.25", scenario)] %>% 
  tidytable::mutate(ISS.error = (ISS - df2$ISS[df2$scenario=="N20_H1.25"])/df2$ISS[df2$scenario=="N20_H1.25"],
                    type = "H1.25",
                    .by = scenario) %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 1, end = -7)) -> df3.3

df3.1 %>% 
  tidytable::bind_rows(df3.2) %>% 
  tidytable::bind_rows(df3.3) %>% 
  tidytable::mutate(scenario = forcats::fct_inorder(scenario)) -> df4



df4 %>% 
  ggplot(aes(x = scenario, y = ISS.error*100)) +
  geom_boxplot(aes(fill = type)) +
  labs(x = "Scenario", y = "ISSB % Error") +
  theme_classic() +
  theme(legend.position = c(0.5, 0.2)) +
  geom_hline(yintercept = -10, linetype = "dashed", color = "black") +
  geom_hline(yintercept = 10, linetype = "dashed", color = "black") +
  scale_y_continuous(breaks = seq(-100, 120, by = 10))


# Stats
df4 %>% filter(type=="trip", scenario=="N_0.25") %>% pull(ISS.error) %>% median
df4 %>% filter(type=="trip", scenario=="N_2.00") %>% pull(ISS.error) %>% median
df4 %>% filter(type=="haul", scenario=="N_0.25") %>% pull(ISS.error) %>% median
df4 %>% filter(type=="haul", scenario=="N_2.00") %>% pull(ISS.error) %>% median


```






### Samples VS Haul. Boxplots Together 1999-2023. sub-sample range
```{r, fig.width=8}

out_24.1 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_24.1_ISS_200_iters_2025-01-02.RDS")

year = out_24.1$samples_1$trip_0.25$length$iss$YEAR
samples_global = c(1, 5, 10, 15, 20, 25, 30, 35)
proportion_global = c(0.25, 0.50, 0.75, 1.25, 1.50, 1.75, 2.00)


df = tidytable(year = year,
               N1_H0.5 = out_24.1$samples_1$trip_0.5$length$iss$iss,
               N5_H0.5 = out_24.1$samples_5$trip_0.5$length$iss$iss,
               N10_H0.5 = out_24.1$samples_10$trip_0.5$length$iss$iss,
               N15_H0.5 = out_24.1$samples_15$trip_0.5$length$iss$iss,
               N20_H0.5 = out_24.1$samples_20$trip_0.5$length$iss$iss,
               N25_H0.5 = out_24.1$samples_25$trip_0.5$length$iss$iss,
               N30_H0.5 = out_24.1$samples_30$trip_0.5$length$iss$iss,
               N35_H0.5 = out_24.1$samples_35$trip_0.5$length$iss$iss,
               N1_H0.75 = out_24.1$samples_1$trip_0.75$length$iss$iss,
               N5_H0.75 = out_24.1$samples_5$trip_0.75$length$iss$iss,
               N10_H0.75 = out_24.1$samples_10$trip_0.75$length$iss$iss,
               N15_H0.75 = out_24.1$samples_15$trip_0.75$length$iss$iss,
               N20_H0.75 = out_24.1$samples_20$trip_0.75$length$iss$iss,
               N25_H0.75 = out_24.1$samples_25$trip_0.75$length$iss$iss,
               N30_H0.75 = out_24.1$samples_30$trip_0.75$length$iss$iss,
               N35_H0.75 = out_24.1$samples_35$trip_0.75$length$iss$iss,
               N1_H1.0 = out_22.1$samples_1$expansion_haul_month_numbers$length$iss$iss,
               N5_H1.0 = out_22.1$samples_5$expansion_haul_month_numbers$length$iss$iss,
               N10_H1.0 = out_22.1$samples_10$expansion_haul_month_numbers$length$iss$iss,
               N15_H1.0 = out_22.1$samples_15$expansion_haul_month_numbers$length$iss$iss,
               N20_H1.0 = out_22.1$samples_20$expansion_haul_month_numbers$length$iss$iss,
               N25_H1.0 = out_22.1$samples_25$expansion_haul_month_numbers$length$iss$iss,
               N30_H1.0 = out_22.1$samples_30$expansion_haul_month_numbers$length$iss$iss,
               N35_H1.0 = out_22.1$samples_35$expansion_haul_month_numbers$length$iss$iss,
               N1_H1.25 = out_24.1$samples_1$trip_1.25$length$iss$iss,
               N5_H1.25 = out_24.1$samples_5$trip_1.25$length$iss$iss,
               N10_H1.25 = out_24.1$samples_10$trip_1.25$length$iss$iss,
               N15_H1.25 = out_24.1$samples_15$trip_1.25$length$iss$iss,
               N20_H1.25 = out_24.1$samples_20$trip_1.25$length$iss$iss,
               N25_H1.25 = out_24.1$samples_25$trip_1.25$length$iss$iss,
               N30_H1.25 = out_24.1$samples_30$trip_1.25$length$iss$iss,
               N35_H1.25 = out_24.1$samples_35$trip_1.25$length$iss$iss) 

df2 = melt.data.table(df, id.vars = "year", variable.name = "scenario", value.name = "ISS")

df2[grep("H0.5", scenario)] %>% 
  tidytable::mutate(ISS.error = (ISS - df2$ISS[df2$scenario=="N20_H0.5"])/df2$ISS[df2$scenario=="N20_H0.5"],
                    type = "0.5",
                    .by = scenario) %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 1, end = -6)) -> df3.01


df2[grep("H0.75", scenario)] %>% 
  tidytable::mutate(ISS.error = (ISS - df2$ISS[df2$scenario=="N20_H0.75"])/df2$ISS[df2$scenario=="N20_H0.75"],
                    type = "0.75",
                    .by = scenario) %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 1, end = -7)) -> df3.1

df2[grep("H1.0", scenario)] %>% 
  tidytable::mutate(ISS.error = (ISS - df2$ISS[df2$scenario=="N20_H1.0"])/df2$ISS[df2$scenario=="N20_H1.0"],
                    type = "1.0",
                    .by = scenario) %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 1, end = -6)) -> df3.2

df2[grep("H1.25", scenario)] %>% 
  tidytable::mutate(ISS.error = (ISS - df2$ISS[df2$scenario=="N20_H1.25"])/df2$ISS[df2$scenario=="N20_H1.25"],
                    type = "1.25",
                    .by = scenario) %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 1, end = -7)) -> df3.3

df3.01 %>% 
  tidytable::bind_rows(df3.1) %>% 
  tidytable::bind_rows(df3.2) %>% 
  tidytable::bind_rows(df3.3) %>% 
  tidytable::mutate(scenario = forcats::fct_inorder(scenario)) -> df4
df4 -> df4.1.a

df4 %>% 
  ggplot(aes(x = scenario, y = ISS.error*100)) +
  geom_boxplot(aes(fill = type)) +
  labs(x = "Scenario", y = "ISSB % Error") +
  theme_classic() +
  theme(legend.position = c(0.5, 0.2)) +
  geom_hline(yintercept = -10, linetype = "dashed", color = "black") +
  geom_hline(yintercept = 10, linetype = "dashed", color = "black") +
  scale_y_continuous(breaks = seq(-100, 120, by = 10))

df4 %>% 
  tidytable::filter(scenario %in% c("N5", "N10", "N15")) %>% 
  ggplot(aes(x = scenario, y = ISS.error*100)) +
  geom_boxplot(aes(fill = type)) +
  labs(x = "Scenario", y = "ISSB % Error") +
  theme_classic() +
  theme(legend.position = c(0.5, 0.2)) +
  geom_hline(yintercept = -10, linetype = "dashed", color = "black") +
  geom_hline(yintercept = 10, linetype = "dashed", color = "black") +
  scale_y_continuous(breaks = seq(-100, 120, by = 10))


# Stats
df4 %>% filter(type=="trip", scenario=="N_0.25") %>% pull(ISS.error) %>% median
df4 %>% filter(type=="trip", scenario=="N_2.00") %>% pull(ISS.error) %>% median
df4 %>% filter(type=="haul", scenario=="N_0.25") %>% pull(ISS.error) %>% median
df4 %>% filter(type=="haul", scenario=="N_2.00") %>% pull(ISS.error) %>% median


```






### Samples VS Haul TAKE 2: relative to unbiased control. Boxplots Together 1999-2023. sub-sample range
```{r, fig.width=8}

out_24.1 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_24.1_ISS_200_iters_2025-01-02.RDS")

year = out_24.1$samples_1$trip_0.25$length$iss$YEAR
samples_global = c(1, 5, 10, 15, 20, 25, 30, 35)
proportion_global = c(0.25, 0.50, 0.75, 1.25, 1.50, 1.75, 2.00)


df = tidytable(year = year,
               N1_H0.5 = out_24.1$samples_1$trip_0.5$length$iss$iss,
               N5_H0.5 = out_24.1$samples_5$trip_0.5$length$iss$iss,
               N10_H0.5 = out_24.1$samples_10$trip_0.5$length$iss$iss,
               N15_H0.5 = out_24.1$samples_15$trip_0.5$length$iss$iss,
               N20_H0.5 = out_24.1$samples_20$trip_0.5$length$iss$iss,
               N25_H0.5 = out_24.1$samples_25$trip_0.5$length$iss$iss,
               N30_H0.5 = out_24.1$samples_30$trip_0.5$length$iss$iss,
               N35_H0.5 = out_24.1$samples_35$trip_0.5$length$iss$iss,
               N1_H0.75 = out_24.1$samples_1$trip_0.75$length$iss$iss,
               N5_H0.75 = out_24.1$samples_5$trip_0.75$length$iss$iss,
               N10_H0.75 = out_24.1$samples_10$trip_0.75$length$iss$iss,
               N15_H0.75 = out_24.1$samples_15$trip_0.75$length$iss$iss,
               N20_H0.75 = out_24.1$samples_20$trip_0.75$length$iss$iss,
               N25_H0.75 = out_24.1$samples_25$trip_0.75$length$iss$iss,
               N30_H0.75 = out_24.1$samples_30$trip_0.75$length$iss$iss,
               N35_H0.75 = out_24.1$samples_35$trip_0.75$length$iss$iss,
               N1_H1.0 = out_22.1$samples_1$expansion_haul_month_numbers$length$iss$iss,
               N5_H1.0 = out_22.1$samples_5$expansion_haul_month_numbers$length$iss$iss,
               N10_H1.0 = out_22.1$samples_10$expansion_haul_month_numbers$length$iss$iss,
               N15_H1.0 = out_22.1$samples_15$expansion_haul_month_numbers$length$iss$iss,
               N20_H1.0 = out_22.1$samples_20$expansion_haul_month_numbers$length$iss$iss,
               N25_H1.0 = out_22.1$samples_25$expansion_haul_month_numbers$length$iss$iss,
               N30_H1.0 = out_22.1$samples_30$expansion_haul_month_numbers$length$iss$iss,
               N35_H1.0 = out_22.1$samples_35$expansion_haul_month_numbers$length$iss$iss,
               N1_H1.25 = out_24.1$samples_1$trip_1.25$length$iss$iss,
               N5_H1.25 = out_24.1$samples_5$trip_1.25$length$iss$iss,
               N10_H1.25 = out_24.1$samples_10$trip_1.25$length$iss$iss,
               N15_H1.25 = out_24.1$samples_15$trip_1.25$length$iss$iss,
               N20_H1.25 = out_24.1$samples_20$trip_1.25$length$iss$iss,
               N25_H1.25 = out_24.1$samples_25$trip_1.25$length$iss$iss,
               N30_H1.25 = out_24.1$samples_30$trip_1.25$length$iss$iss,
               N35_H1.25 = out_24.1$samples_35$trip_1.25$length$iss$iss) 

df2 = melt.data.table(df, id.vars = "year", variable.name = "scenario", value.name = "ISS")

df2[grep("H0.5", scenario)] %>% 
  tidytable::mutate(ISS.error = (ISS - df2$ISS[df2$scenario=="N20_H1.0"])/df2$ISS[df2$scenario=="N20_H1.0"],
                    type = "0.5",
                    .by = scenario) %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 1, end = -6)) -> df3.01


df2[grep("H0.75", scenario)] %>% 
  tidytable::mutate(ISS.error = (ISS - df2$ISS[df2$scenario=="N20_H1.0"])/df2$ISS[df2$scenario=="N20_H1.0"],
                    type = "0.75",
                    .by = scenario) %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 1, end = -7)) -> df3.1

df2[grep("H1.0", scenario)] %>% 
  tidytable::mutate(ISS.error = (ISS - df2$ISS[df2$scenario=="N20_H1.0"])/df2$ISS[df2$scenario=="N20_H1.0"],
                    type = "1.0",
                    .by = scenario) %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 1, end = -6)) -> df3.2

df2[grep("H1.25", scenario)] %>% 
  tidytable::mutate(ISS.error = (ISS - df2$ISS[df2$scenario=="N20_H1.0"])/df2$ISS[df2$scenario=="N20_H1.0"],
                    type = "1.25",
                    .by = scenario) %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 1, end = -7)) -> df3.3

df3.01 %>% 
  tidytable::bind_rows(df3.1) %>% 
  tidytable::bind_rows(df3.2) %>% 
  tidytable::bind_rows(df3.3) %>% 
  tidytable::mutate(scenario = forcats::fct_inorder(scenario)) -> df4
df4 -> df4.1.b


df4 %>% 
  ggplot(aes(x = scenario, y = ISS.error*100)) +
  geom_boxplot(aes(fill = type)) +
  labs(x = "Scenario", y = "ISSB % Error") +
  theme_classic() +
  theme(legend.position = c(0.5, 0.2)) +
  geom_hline(yintercept = -10, linetype = "dashed", color = "black") +
  geom_hline(yintercept = 10, linetype = "dashed", color = "black") +
  scale_y_continuous(breaks = seq(-100, 120, by = 10))

df4 %>% 
  tidytable::filter(scenario %in% c("N5", "N10", "N15")) %>% 
  ggplot(aes(x = scenario, y = ISS.error*100)) +
  geom_boxplot(aes(fill = type)) +
  labs(x = "Scenario", y = "ISSB % Error") +
  theme_classic() +
  theme(legend.position = c(0.5, 0.2)) +
  geom_hline(yintercept = -10, linetype = "dashed", color = "black") +
  geom_hline(yintercept = 10, linetype = "dashed", color = "black") +
  scale_y_continuous(breaks = seq(-100, 120, by = 10))


# Stats
df4 %>% filter(type=="trip", scenario=="N_0.25") %>% pull(ISS.error) %>% median
df4 %>% filter(type=="trip", scenario=="N_2.00") %>% pull(ISS.error) %>% median
df4 %>% filter(type=="haul", scenario=="N_0.25") %>% pull(ISS.error) %>% median
df4 %>% filter(type=="haul", scenario=="N_2.00") %>% pull(ISS.error) %>% median


```





### Samples VS Trip. Boxplots Together 1999-2023
```{r, fig.width=8}

out_23.1 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_23.1_ISS_200_iters_2024-12-31.RDS")

year = out_23.1$samples_1$trip_0.25$length$iss$YEAR
samples_global = c(1, 5, 10, 15, 20, 25, 30, 35)
proportion_global = c(0.25, 0.50, 0.75, 1.25, 1.50, 1.75, 2.00)


df = tidytable(year = year,
               N1_H0.5 = out_23.1$samples_1$trip_0.5$length$iss$iss,
               N5_H0.5 = out_23.1$samples_5$trip_0.5$length$iss$iss,
               N10_H0.5 = out_23.1$samples_10$trip_0.5$length$iss$iss,
               N15_H0.5 = out_23.1$samples_15$trip_0.5$length$iss$iss,
               N20_H0.5 = out_23.1$samples_20$trip_0.5$length$iss$iss,
               N25_H0.5 = out_23.1$samples_25$trip_0.5$length$iss$iss,
               N30_H0.5 = out_23.1$samples_30$trip_0.5$length$iss$iss,
               N35_H0.5 = out_23.1$samples_35$trip_0.5$length$iss$iss,
               N1_H0.75 = out_23.1$samples_1$trip_0.75$length$iss$iss,
               N5_H0.75 = out_23.1$samples_5$trip_0.75$length$iss$iss,
               N10_H0.75 = out_23.1$samples_10$trip_0.75$length$iss$iss,
               N15_H0.75 = out_23.1$samples_15$trip_0.75$length$iss$iss,
               N20_H0.75 = out_23.1$samples_20$trip_0.75$length$iss$iss,
               N25_H0.75 = out_23.1$samples_25$trip_0.75$length$iss$iss,
               N30_H0.75 = out_23.1$samples_30$trip_0.75$length$iss$iss,
               N35_H0.75 = out_23.1$samples_35$trip_0.75$length$iss$iss,
               N1_H1.0 = out_22.1$samples_1$expansion_haul_month_numbers$length$iss$iss,
               N5_H1.0 = out_22.1$samples_5$expansion_haul_month_numbers$length$iss$iss,
               N10_H1.0 = out_22.1$samples_10$expansion_haul_month_numbers$length$iss$iss,
               N15_H1.0 = out_22.1$samples_15$expansion_haul_month_numbers$length$iss$iss,
               N20_H1.0 = out_22.1$samples_20$expansion_haul_month_numbers$length$iss$iss,
               N25_H1.0 = out_22.1$samples_25$expansion_haul_month_numbers$length$iss$iss,
               N30_H1.0 = out_22.1$samples_30$expansion_haul_month_numbers$length$iss$iss,
               N35_H1.0 = out_22.1$samples_35$expansion_haul_month_numbers$length$iss$iss,
               N1_H1.25 = out_23.1$samples_1$trip_1.25$length$iss$iss,
               N5_H1.25 = out_23.1$samples_5$trip_1.25$length$iss$iss,
               N10_H1.25 = out_23.1$samples_10$trip_1.25$length$iss$iss,
               N15_H1.25 = out_23.1$samples_15$trip_1.25$length$iss$iss,
               N20_H1.25 = out_23.1$samples_20$trip_1.25$length$iss$iss,
               N25_H1.25 = out_23.1$samples_25$trip_1.25$length$iss$iss,
               N30_H1.25 = out_23.1$samples_30$trip_1.25$length$iss$iss,
               N35_H1.25 = out_23.1$samples_35$trip_1.25$length$iss$iss) 

df2 = melt.data.table(df, id.vars = "year", variable.name = "scenario", value.name = "ISS")

df2[grep("H0.5", scenario)] %>% 
  tidytable::mutate(ISS.error = (ISS - df2$ISS[df2$scenario=="N20_H0.5"])/df2$ISS[df2$scenario=="N20_H0.5"],
                    type = "0.5",
                    .by = scenario) %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 1, end = -6)) -> df3.01


df2[grep("H0.75", scenario)] %>% 
  tidytable::mutate(ISS.error = (ISS - df2$ISS[df2$scenario=="N20_H0.75"])/df2$ISS[df2$scenario=="N20_H0.75"],
                    type = "0.75",
                    .by = scenario) %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 1, end = -7)) -> df3.1

df2[grep("H1.0", scenario)] %>% 
  tidytable::mutate(ISS.error = (ISS - df2$ISS[df2$scenario=="N20_H1.0"])/df2$ISS[df2$scenario=="N20_H1.0"],
                    type = "1.0",
                    .by = scenario) %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 1, end = -6)) -> df3.2

df2[grep("H1.25", scenario)] %>% 
  tidytable::mutate(ISS.error = (ISS - df2$ISS[df2$scenario=="N20_H1.25"])/df2$ISS[df2$scenario=="N20_H1.25"],
                    type = "1.25",
                    .by = scenario) %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 1, end = -7)) -> df3.3

df3.01 %>% 
  tidytable::bind_rows(df3.1) %>% 
  tidytable::bind_rows(df3.2) %>% 
  tidytable::bind_rows(df3.3) %>% 
  tidytable::mutate(scenario = forcats::fct_inorder(scenario)) -> df4
df4 -> df4.2.a


df4 %>% 
  ggplot(aes(x = scenario, y = ISS.error*100)) +
  geom_boxplot(aes(fill = type)) +
  labs(x = "Scenario", y = "ISSB % Error") +
  theme_classic() +
  theme(legend.position = c(0.5, 0.2)) +
  geom_hline(yintercept = -10, linetype = "dashed", color = "black") +
  geom_hline(yintercept = 10, linetype = "dashed", color = "black") +
  scale_y_continuous(breaks = seq(-100, 120, by = 10))

df4 %>% 
  tidytable::filter(scenario %in% c("N5", "N10", "N15")) %>% 
  ggplot(aes(x = scenario, y = ISS.error*100)) +
  geom_boxplot(aes(fill = type)) +
  labs(x = "Scenario", y = "ISSB % Error") +
  theme_classic() +
  theme(legend.position = c(0.5, 0.2)) +
  geom_hline(yintercept = -10, linetype = "dashed", color = "black") +
  geom_hline(yintercept = 10, linetype = "dashed", color = "black") +
  scale_y_continuous(breaks = seq(-100, 120, by = 10))


# Stats
df4 %>% filter(type=="trip", scenario=="N_0.25") %>% pull(ISS.error) %>% median
df4 %>% filter(type=="trip", scenario=="N_2.00") %>% pull(ISS.error) %>% median
df4 %>% filter(type=="haul", scenario=="N_0.25") %>% pull(ISS.error) %>% median
df4 %>% filter(type=="haul", scenario=="N_2.00") %>% pull(ISS.error) %>% median


```



### Samples VS Trip TAKE 2: relative to unbiased control. Boxplots Together 1999-2023
```{r, fig.width=8}

out_23.1 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_23.1_ISS_200_iters_2024-12-31.RDS")

year = out_23.1$samples_1$trip_0.25$length$iss$YEAR
samples_global = c(1, 5, 10, 15, 20, 25, 30, 35)
proportion_global = c(0.25, 0.50, 0.75, 1.25, 1.50, 1.75, 2.00)


df = tidytable(year = year,
               N1_H0.5 = out_23.1$samples_1$trip_0.5$length$iss$iss,
               N5_H0.5 = out_23.1$samples_5$trip_0.5$length$iss$iss,
               N10_H0.5 = out_23.1$samples_10$trip_0.5$length$iss$iss,
               N15_H0.5 = out_23.1$samples_15$trip_0.5$length$iss$iss,
               N20_H0.5 = out_23.1$samples_20$trip_0.5$length$iss$iss,
               N25_H0.5 = out_23.1$samples_25$trip_0.5$length$iss$iss,
               N30_H0.5 = out_23.1$samples_30$trip_0.5$length$iss$iss,
               N35_H0.5 = out_23.1$samples_35$trip_0.5$length$iss$iss,
               N1_H0.75 = out_23.1$samples_1$trip_0.75$length$iss$iss,
               N5_H0.75 = out_23.1$samples_5$trip_0.75$length$iss$iss,
               N10_H0.75 = out_23.1$samples_10$trip_0.75$length$iss$iss,
               N15_H0.75 = out_23.1$samples_15$trip_0.75$length$iss$iss,
               N20_H0.75 = out_23.1$samples_20$trip_0.75$length$iss$iss,
               N25_H0.75 = out_23.1$samples_25$trip_0.75$length$iss$iss,
               N30_H0.75 = out_23.1$samples_30$trip_0.75$length$iss$iss,
               N35_H0.75 = out_23.1$samples_35$trip_0.75$length$iss$iss,
               N1_H1.0 = out_22.1$samples_1$expansion_haul_month_numbers$length$iss$iss,
               N5_H1.0 = out_22.1$samples_5$expansion_haul_month_numbers$length$iss$iss,
               N10_H1.0 = out_22.1$samples_10$expansion_haul_month_numbers$length$iss$iss,
               N15_H1.0 = out_22.1$samples_15$expansion_haul_month_numbers$length$iss$iss,
               N20_H1.0 = out_22.1$samples_20$expansion_haul_month_numbers$length$iss$iss,
               N25_H1.0 = out_22.1$samples_25$expansion_haul_month_numbers$length$iss$iss,
               N30_H1.0 = out_22.1$samples_30$expansion_haul_month_numbers$length$iss$iss,
               N35_H1.0 = out_22.1$samples_35$expansion_haul_month_numbers$length$iss$iss,
               N1_H1.25 = out_23.1$samples_1$trip_1.25$length$iss$iss,
               N5_H1.25 = out_23.1$samples_5$trip_1.25$length$iss$iss,
               N10_H1.25 = out_23.1$samples_10$trip_1.25$length$iss$iss,
               N15_H1.25 = out_23.1$samples_15$trip_1.25$length$iss$iss,
               N20_H1.25 = out_23.1$samples_20$trip_1.25$length$iss$iss,
               N25_H1.25 = out_23.1$samples_25$trip_1.25$length$iss$iss,
               N30_H1.25 = out_23.1$samples_30$trip_1.25$length$iss$iss,
               N35_H1.25 = out_23.1$samples_35$trip_1.25$length$iss$iss) 

df2 = melt.data.table(df, id.vars = "year", variable.name = "scenario", value.name = "ISS")

df2[grep("H0.5", scenario)] %>% 
  tidytable::mutate(ISS.error = (ISS - df2$ISS[df2$scenario=="N20_H1.0"])/df2$ISS[df2$scenario=="N20_H1.0"],
                    type = "0.5",
                    .by = scenario) %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 1, end = -6)) -> df3.01


df2[grep("H0.75", scenario)] %>% 
  tidytable::mutate(ISS.error = (ISS - df2$ISS[df2$scenario=="N20_H1.0"])/df2$ISS[df2$scenario=="N20_H1.0"],
                    type = "0.75",
                    .by = scenario) %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 1, end = -7)) -> df3.1

df2[grep("H1.0", scenario)] %>% 
  tidytable::mutate(ISS.error = (ISS - df2$ISS[df2$scenario=="N20_H1.0"])/df2$ISS[df2$scenario=="N20_H1.0"],
                    type = "1.0",
                    .by = scenario) %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 1, end = -6)) -> df3.2

df2[grep("H1.25", scenario)] %>% 
  tidytable::mutate(ISS.error = (ISS - df2$ISS[df2$scenario=="N20_H1.0"])/df2$ISS[df2$scenario=="N20_H1.0"],
                    type = "1.25",
                    .by = scenario) %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 1, end = -7)) -> df3.3

df3.01 %>% 
  tidytable::bind_rows(df3.1) %>% 
  tidytable::bind_rows(df3.2) %>% 
  tidytable::bind_rows(df3.3) %>% 
  tidytable::mutate(scenario = forcats::fct_inorder(scenario)) -> df4
df4 -> df4.2.b


df4 %>% 
  ggplot(aes(x = scenario, y = ISS.error*100)) +
  geom_boxplot(aes(fill = type)) +
  labs(x = "Scenario", y = "ISSB % Error") +
  theme_classic() +
  theme(legend.position = c(0.5, 0.2)) +
  geom_hline(yintercept = -10, linetype = "dashed", color = "black") +
  geom_hline(yintercept = 10, linetype = "dashed", color = "black") +
  scale_y_continuous(breaks = seq(-100, 120, by = 10))

df4 %>% 
  tidytable::filter(scenario %in% c("N5", "N10", "N15")) %>% 
  ggplot(aes(x = scenario, y = ISS.error*100)) +
  geom_boxplot(aes(fill = type)) +
  labs(x = "Scenario", y = "ISSB % Error") +
  theme_classic() +
  theme(legend.position = c(0.5, 0.2)) +
  geom_hline(yintercept = -10, linetype = "dashed", color = "black") +
  geom_hline(yintercept = 10, linetype = "dashed", color = "black") +
  scale_y_continuous(breaks = seq(-100, 120, by = 10))


# Stats
df4 %>% filter(type=="trip", scenario=="N_0.25") %>% pull(ISS.error) %>% median
df4 %>% filter(type=="trip", scenario=="N_2.00") %>% pull(ISS.error) %>% median
df4 %>% filter(type=="haul", scenario=="N_0.25") %>% pull(ISS.error) %>% median
df4 %>% filter(type=="haul", scenario=="N_2.00") %>% pull(ISS.error) %>% median


```







### Samples VS Trip/Haul. Boxplots Together 1999-2023
```{r, fig.width=8}

out_25.1 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_25.1_ISS_200_iters_2025-01-03.RDS")

year = out_25.1$samples_1$haul_0.5_trip_0.5$length$iss$YEAR


df = tidytable(year = year,
               N1_H0.5_T0.5 = out_25.1$samples_1$haul_0.5_trip_0.5$length$iss$iss,
               N5_H0.5_T0.5 = out_25.1$samples_5$haul_0.5_trip_0.5$length$iss$iss,
               N10_H0.5_T0.5 = out_25.1$samples_10$haul_0.5_trip_0.5$length$iss$iss,
               N15_H0.5_T0.5 = out_25.1$samples_15$haul_0.5_trip_0.5$length$iss$iss,
               N20_H0.5_T0.5 = out_25.1$samples_20$haul_0.5_trip_0.5$length$iss$iss,
               N25_H0.5_T0.5 = out_25.1$samples_25$haul_0.5_trip_0.5$length$iss$iss,
               N30_H0.5_T0.5 = out_25.1$samples_30$haul_0.5_trip_0.5$length$iss$iss,
               N35_H0.5_T0.5 = out_25.1$samples_35$haul_0.5_trip_0.5$length$iss$iss,
               
               N1_H0.5_T0.75 = out_25.1$samples_1$haul_0.5_trip_0.75$length$iss$iss,
               N5_H0.5_T0.75 = out_25.1$samples_5$haul_0.5_trip_0.75$length$iss$iss,
               N10_H0.5_T0.75 = out_25.1$samples_10$haul_0.5_trip_0.75$length$iss$iss,
               N15_H0.5_T0.75 = out_25.1$samples_15$haul_0.5_trip_0.75$length$iss$iss,
               N20_H0.5_T0.75 = out_25.1$samples_20$haul_0.5_trip_0.75$length$iss$iss,
               N25_H0.5_T0.75 = out_25.1$samples_25$haul_0.5_trip_0.75$length$iss$iss,
               N30_H0.5_T0.75 = out_25.1$samples_30$haul_0.5_trip_0.75$length$iss$iss,
               N35_H0.5_T0.75 = out_25.1$samples_35$haul_0.5_trip_0.75$length$iss$iss,
               
               N1_H0.75_T0.5 = out_25.1$samples_1$haul_0.75_trip_0.5$length$iss$iss,
               N5_H0.75_T0.5 = out_25.1$samples_5$haul_0.75_trip_0.5$length$iss$iss,
               N10_H0.75_T0.5 = out_25.1$samples_10$haul_0.75_trip_0.5$length$iss$iss,
               N15_H0.75_T0.5 = out_25.1$samples_15$haul_0.75_trip_0.5$length$iss$iss,
               N20_H0.75_T0.5 = out_25.1$samples_20$haul_0.75_trip_0.5$length$iss$iss,
               N25_H0.75_T0.5 = out_25.1$samples_25$haul_0.75_trip_0.5$length$iss$iss,
               N30_H0.75_T0.5 = out_25.1$samples_30$haul_0.75_trip_0.5$length$iss$iss,
               N35_H0.75_T0.5 = out_25.1$samples_35$haul_0.75_trip_0.5$length$iss$iss,
               
               N1_H0.75_T0.75 = out_25.1$samples_1$haul_0.75_trip_0.75$length$iss$iss,
               N5_H0.75_T0.75 = out_25.1$samples_5$haul_0.75_trip_0.75$length$iss$iss,
               N10_H0.75_T0.75 = out_25.1$samples_10$haul_0.75_trip_0.75$length$iss$iss,
               N15_H0.75_T0.75 = out_25.1$samples_15$haul_0.75_trip_0.75$length$iss$iss,
               N20_H0.75_T0.75 = out_25.1$samples_20$haul_0.75_trip_0.75$length$iss$iss,
               N25_H0.75_T0.75 = out_25.1$samples_25$haul_0.75_trip_0.75$length$iss$iss,
               N30_H0.75_T0.75 = out_25.1$samples_30$haul_0.75_trip_0.75$length$iss$iss,
               N35_H0.75_T0.75 = out_25.1$samples_35$haul_0.75_trip_0.75$length$iss$iss,
               
               N1_H1.25_T0.5 = out_25.1$samples_1$haul_1.25_trip_0.5$length$iss$iss,
               N5_H1.25_T0.5 = out_25.1$samples_5$haul_1.25_trip_0.5$length$iss$iss,
               N10_H1.25_T0.5 = out_25.1$samples_10$haul_1.25_trip_0.5$length$iss$iss,
               N15_H1.25_T0.5 = out_25.1$samples_15$haul_1.25_trip_0.5$length$iss$iss,
               N20_H1.25_T0.5 = out_25.1$samples_20$haul_1.25_trip_0.5$length$iss$iss,
               N25_H1.25_T0.5 = out_25.1$samples_25$haul_1.25_trip_0.5$length$iss$iss,
               N30_H1.25_T0.5 = out_25.1$samples_30$haul_1.25_trip_0.5$length$iss$iss,
               N35_H1.25_T0.5 = out_25.1$samples_35$haul_1.25_trip_0.5$length$iss$iss,
               
               N1_H1.25_T0.75 = out_25.1$samples_1$haul_1.25_trip_0.75$length$iss$iss,
               N5_H1.25_T0.75 = out_25.1$samples_5$haul_1.25_trip_0.75$length$iss$iss,
               N10_H1.25_T0.75 = out_25.1$samples_10$haul_1.25_trip_0.75$length$iss$iss,
               N15_H1.25_T0.75 = out_25.1$samples_15$haul_1.25_trip_0.75$length$iss$iss,
               N20_H1.25_T0.75 = out_25.1$samples_20$haul_1.25_trip_0.75$length$iss$iss,
               N25_H1.25_T0.75 = out_25.1$samples_25$haul_1.25_trip_0.75$length$iss$iss,
               N30_H1.25_T0.75 = out_25.1$samples_30$haul_1.25_trip_0.75$length$iss$iss,
               N35_H1.25_T0.75 = out_25.1$samples_35$haul_1.25_trip_0.75$length$iss$iss)

df2 = melt.data.table(df, id.vars = "year", variable.name = "scenario", value.name = "ISS")

scenario_names = c("H0.5_T0.5", "H0.5_T0.75", "H0.75_T0.5", "H0.75_T0.75", "H1.25_T0.5", "H1.25_T0.75")

## 1
df2[grep(scenario_names[1], scenario)] %>% 
  tidytable::mutate(ISS.error = (ISS - df2$ISS[df2$scenario==paste("N20", scenario_names[1], sep = "_")])/df2$ISS[df2$scenario==paste("N20", scenario_names[1], sep = "_")],
                    type = scenario_names[1],
                    .by = scenario) %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 1, end = -(nchar(scenario_names[1])+2))) -> df3.1

## 2
df2[grep(scenario_names[2], scenario)] %>% 
  tidytable::mutate(ISS.error = (ISS - df2$ISS[df2$scenario==paste("N20", scenario_names[2], sep = "_")])/df2$ISS[df2$scenario==paste("N20", scenario_names[2], sep = "_")],
                    type = scenario_names[2],
                    .by = scenario) %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 1, end = -(nchar(scenario_names[2])+2))) -> df3.2

## 3
df2[grep(scenario_names[3], scenario)] %>% 
  tidytable::mutate(ISS.error = (ISS - df2$ISS[df2$scenario==paste("N20", scenario_names[3], sep = "_")])/df2$ISS[df2$scenario==paste("N20", scenario_names[3], sep = "_")],
                    type = scenario_names[3],
                    .by = scenario) %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 1, end = -(nchar(scenario_names[3])+2))) -> df3.3


## 4
df2[grep(scenario_names[4], scenario)] %>% 
  tidytable::mutate(ISS.error = (ISS - df2$ISS[df2$scenario==paste("N20", scenario_names[4], sep = "_")])/df2$ISS[df2$scenario==paste("N20", scenario_names[4], sep = "_")],
                    type = scenario_names[4],
                    .by = scenario) %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 1, end = -(nchar(scenario_names[4])+2))) -> df3.4

## 5
df2[grep(scenario_names[5], scenario)] %>% 
  tidytable::mutate(ISS.error = (ISS - df2$ISS[df2$scenario==paste("N20", scenario_names[5], sep = "_")])/df2$ISS[df2$scenario==paste("N20", scenario_names[5], sep = "_")],
                    type = scenario_names[5],
                    .by = scenario) %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 1, end = -(nchar(scenario_names[5])+2))) -> df3.5









df3.1 %>% 
  tidytable::bind_rows(df3.2) %>% 
  tidytable::bind_rows(df3.3) %>% 
  tidytable::bind_rows(df3.4) %>% 
  tidytable::bind_rows(df3.5) %>% 
  tidytable::mutate(scenario = forcats::fct_inorder(scenario)) -> df4
df4 -> df4.3.a


df4 %>% 
  ggplot(aes(x = scenario, y = ISS.error*100)) +
  geom_boxplot(aes(fill = type)) +
  labs(x = "Scenario", y = "ISSB % Error") +
  theme_classic() +
  theme(legend.position = c(0.5, 0.2)) +
  geom_hline(yintercept = -10, linetype = "dashed", color = "black") +
  geom_hline(yintercept = 10, linetype = "dashed", color = "black") +
  scale_y_continuous(breaks = seq(-100, 120, by = 10))

df4 %>% 
  tidytable::filter(scenario %in% c("N5", "N10", "N15")) %>% 
  ggplot(aes(x = scenario, y = ISS.error*100)) +
  geom_boxplot(aes(fill = type)) +
  labs(x = "Scenario", y = "ISSB % Error") +
  theme_classic() +
  theme(legend.position = c(0.5, 0.2)) +
  geom_hline(yintercept = -10, linetype = "dashed", color = "black") +
  geom_hline(yintercept = 10, linetype = "dashed", color = "black") +
  scale_y_continuous(breaks = seq(-100, 120, by = 10))


# Stats
df4 %>% filter(type=="trip", scenario=="N_0.25") %>% pull(ISS.error) %>% median
df4 %>% filter(type=="trip", scenario=="N_2.00") %>% pull(ISS.error) %>% median
df4 %>% filter(type=="haul", scenario=="N_0.25") %>% pull(ISS.error) %>% median
df4 %>% filter(type=="haul", scenario=="N_2.00") %>% pull(ISS.error) %>% median


```






### Samples VS Trip/Haul TAKE 2: relative to unbiased control. Boxplots Together 1999-2023
```{r, fig.width=8}

out_25.1 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_25.1_ISS_200_iters_2025-01-03.RDS")

year = out_25.1$samples_1$haul_0.5_trip_0.5$length$iss$YEAR


df = tidytable(year = year,
               N1_H0.5_T0.5 = out_25.1$samples_1$haul_0.5_trip_0.5$length$iss$iss,
               N5_H0.5_T0.5 = out_25.1$samples_5$haul_0.5_trip_0.5$length$iss$iss,
               N10_H0.5_T0.5 = out_25.1$samples_10$haul_0.5_trip_0.5$length$iss$iss,
               N15_H0.5_T0.5 = out_25.1$samples_15$haul_0.5_trip_0.5$length$iss$iss,
               N20_H0.5_T0.5 = out_25.1$samples_20$haul_0.5_trip_0.5$length$iss$iss,
               N25_H0.5_T0.5 = out_25.1$samples_25$haul_0.5_trip_0.5$length$iss$iss,
               N30_H0.5_T0.5 = out_25.1$samples_30$haul_0.5_trip_0.5$length$iss$iss,
               N35_H0.5_T0.5 = out_25.1$samples_35$haul_0.5_trip_0.5$length$iss$iss,
               
               N1_H0.5_T0.75 = out_25.1$samples_1$haul_0.5_trip_0.75$length$iss$iss,
               N5_H0.5_T0.75 = out_25.1$samples_5$haul_0.5_trip_0.75$length$iss$iss,
               N10_H0.5_T0.75 = out_25.1$samples_10$haul_0.5_trip_0.75$length$iss$iss,
               N15_H0.5_T0.75 = out_25.1$samples_15$haul_0.5_trip_0.75$length$iss$iss,
               N20_H0.5_T0.75 = out_25.1$samples_20$haul_0.5_trip_0.75$length$iss$iss,
               N25_H0.5_T0.75 = out_25.1$samples_25$haul_0.5_trip_0.75$length$iss$iss,
               N30_H0.5_T0.75 = out_25.1$samples_30$haul_0.5_trip_0.75$length$iss$iss,
               N35_H0.5_T0.75 = out_25.1$samples_35$haul_0.5_trip_0.75$length$iss$iss,
               
               N1_H0.75_T0.5 = out_25.1$samples_1$haul_0.75_trip_0.5$length$iss$iss,
               N5_H0.75_T0.5 = out_25.1$samples_5$haul_0.75_trip_0.5$length$iss$iss,
               N10_H0.75_T0.5 = out_25.1$samples_10$haul_0.75_trip_0.5$length$iss$iss,
               N15_H0.75_T0.5 = out_25.1$samples_15$haul_0.75_trip_0.5$length$iss$iss,
               N20_H0.75_T0.5 = out_25.1$samples_20$haul_0.75_trip_0.5$length$iss$iss,
               N25_H0.75_T0.5 = out_25.1$samples_25$haul_0.75_trip_0.5$length$iss$iss,
               N30_H0.75_T0.5 = out_25.1$samples_30$haul_0.75_trip_0.5$length$iss$iss,
               N35_H0.75_T0.5 = out_25.1$samples_35$haul_0.75_trip_0.5$length$iss$iss,
               
               N1_H0.75_T0.75 = out_25.1$samples_1$haul_0.75_trip_0.75$length$iss$iss,
               N5_H0.75_T0.75 = out_25.1$samples_5$haul_0.75_trip_0.75$length$iss$iss,
               N10_H0.75_T0.75 = out_25.1$samples_10$haul_0.75_trip_0.75$length$iss$iss,
               N15_H0.75_T0.75 = out_25.1$samples_15$haul_0.75_trip_0.75$length$iss$iss,
               N20_H0.75_T0.75 = out_25.1$samples_20$haul_0.75_trip_0.75$length$iss$iss,
               N25_H0.75_T0.75 = out_25.1$samples_25$haul_0.75_trip_0.75$length$iss$iss,
               N30_H0.75_T0.75 = out_25.1$samples_30$haul_0.75_trip_0.75$length$iss$iss,
               N35_H0.75_T0.75 = out_25.1$samples_35$haul_0.75_trip_0.75$length$iss$iss,
               
               N1_H1.25_T0.5 = out_25.1$samples_1$haul_1.25_trip_0.5$length$iss$iss,
               N5_H1.25_T0.5 = out_25.1$samples_5$haul_1.25_trip_0.5$length$iss$iss,
               N10_H1.25_T0.5 = out_25.1$samples_10$haul_1.25_trip_0.5$length$iss$iss,
               N15_H1.25_T0.5 = out_25.1$samples_15$haul_1.25_trip_0.5$length$iss$iss,
               N20_H1.25_T0.5 = out_25.1$samples_20$haul_1.25_trip_0.5$length$iss$iss,
               N25_H1.25_T0.5 = out_25.1$samples_25$haul_1.25_trip_0.5$length$iss$iss,
               N30_H1.25_T0.5 = out_25.1$samples_30$haul_1.25_trip_0.5$length$iss$iss,
               N35_H1.25_T0.5 = out_25.1$samples_35$haul_1.25_trip_0.5$length$iss$iss,
               
               N1_H1.25_T0.75 = out_25.1$samples_1$haul_1.25_trip_0.75$length$iss$iss,
               N5_H1.25_T0.75 = out_25.1$samples_5$haul_1.25_trip_0.75$length$iss$iss,
               N10_H1.25_T0.75 = out_25.1$samples_10$haul_1.25_trip_0.75$length$iss$iss,
               N15_H1.25_T0.75 = out_25.1$samples_15$haul_1.25_trip_0.75$length$iss$iss,
               N20_H1.25_T0.75 = out_25.1$samples_20$haul_1.25_trip_0.75$length$iss$iss,
               N25_H1.25_T0.75 = out_25.1$samples_25$haul_1.25_trip_0.75$length$iss$iss,
               N30_H1.25_T0.75 = out_25.1$samples_30$haul_1.25_trip_0.75$length$iss$iss,
               N35_H1.25_T0.75 = out_25.1$samples_35$haul_1.25_trip_0.75$length$iss$iss,
               
               N1_H1.0_T1.0 = out_22.1$samples_1$expansion_haul_month_numbers$length$iss$iss,
               N5_H1.0_T1.0 = out_22.1$samples_5$expansion_haul_month_numbers$length$iss$iss,
               N10_H1.0_T1.0 = out_22.1$samples_10$expansion_haul_month_numbers$length$iss$iss,
               N15_H1.0_T1.0 = out_22.1$samples_15$expansion_haul_month_numbers$length$iss$iss,
               N20_H1.0_T1.0 = out_22.1$samples_20$expansion_haul_month_numbers$length$iss$iss,
               N25_H1.0_T1.0 = out_22.1$samples_25$expansion_haul_month_numbers$length$iss$iss,
               N30_H1.0_T1.0 = out_22.1$samples_30$expansion_haul_month_numbers$length$iss$iss,
               N35_H1.0_T1.0 = out_22.1$samples_35$expansion_haul_month_numbers$length$iss$iss) 

df2 = melt.data.table(df, id.vars = "year", variable.name = "scenario", value.name = "ISS")

scenario_names = c("H0.5_T0.5", "H0.5_T0.75", "H0.75_T0.5", "H0.75_T0.75", "H1.25_T0.5", "H1.25_T0.75", "H1.0_T1.0")
scenario_names.short = c("0.5/0.5", "0.5/0.75", "0.75/0.5", "0.75/0.75", "1.25/0.5", "1.25/0.75", "1.0/1.0")

## 1
df2[grep(scenario_names[1], scenario)] %>% 
  tidytable::mutate(ISS.error = (ISS - df2$ISS[df2$scenario=="N20_H1.0_T1.0"])/df2$ISS[df2$scenario=="N20_H1.0_T1.0"],
                    type = scenario_names.short[1],
                    .by = scenario) %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 1, end = -(nchar(scenario_names[1])+2))) -> df3.1

## 2
df2[grep(scenario_names[2], scenario)] %>% 
  tidytable::mutate(ISS.error = (ISS - df2$ISS[df2$scenario=="N20_H1.0_T1.0"])/df2$ISS[df2$scenario=="N20_H1.0_T1.0"],
                    type = scenario_names.short[2],
                    .by = scenario) %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 1, end = -(nchar(scenario_names[2])+2))) -> df3.2

## 3
df2[grep(scenario_names[3], scenario)] %>% 
  tidytable::mutate(ISS.error = (ISS - df2$ISS[df2$scenario=="N20_H1.0_T1.0"])/df2$ISS[df2$scenario=="N20_H1.0_T1.0"],
                    type = scenario_names.short[3],
                    .by = scenario) %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 1, end = -(nchar(scenario_names[3])+2))) -> df3.3


## 4
df2[grep(scenario_names[4], scenario)] %>% 
  tidytable::mutate(ISS.error = (ISS - df2$ISS[df2$scenario=="N20_H1.0_T1.0"])/df2$ISS[df2$scenario=="N20_H1.0_T1.0"],
                    type = scenario_names.short[4],
                    .by = scenario) %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 1, end = -(nchar(scenario_names[4])+2))) -> df3.4

## 5
df2[grep(scenario_names[5], scenario)] %>% 
  tidytable::mutate(ISS.error = (ISS - df2$ISS[df2$scenario=="N20_H1.0_T1.0"])/df2$ISS[df2$scenario=="N20_H1.0_T1.0"],
                    type = scenario_names.short[5],
                    .by = scenario) %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 1, end = -(nchar(scenario_names[5])+2))) -> df3.5

## 6
df2[grep(scenario_names[6], scenario)] %>% 
  tidytable::mutate(ISS.error = (ISS - df2$ISS[df2$scenario=="N20_H1.0_T1.0"])/df2$ISS[df2$scenario=="N20_H1.0_T1.0"],
                    type = scenario_names.short[6],
                    .by = scenario) %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 1, end = -(nchar(scenario_names[6])+2))) -> df3.6

## 7
df2[grep(scenario_names[7], scenario)] %>% 
  tidytable::mutate(ISS.error = (ISS - df2$ISS[df2$scenario=="N20_H1.0_T1.0"])/df2$ISS[df2$scenario=="N20_H1.0_T1.0"],
                    type = scenario_names.short[7],
                    .by = scenario) %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 1, end = -(nchar(scenario_names[7])+2))) -> df3.7









df3.1 %>% 
  tidytable::bind_rows(df3.2) %>% 
  tidytable::bind_rows(df3.3) %>% 
  tidytable::bind_rows(df3.4) %>% 
  tidytable::bind_rows(df3.5) %>% 
  tidytable::bind_rows(df3.6) %>% 
  tidytable::bind_rows(df3.7) %>% 
  tidytable::mutate(scenario = forcats::fct_inorder(scenario)) -> df4
df4 -> df4.3.b


df4 %>% 
  ggplot(aes(x = scenario, y = ISS.error*100)) +
  geom_boxplot(aes(fill = type)) +
  labs(x = "Scenario", y = "ISSB % Error") +
  theme_classic() +
  theme(legend.position = c(0.5, 0.2)) +
  geom_hline(yintercept = -10, linetype = "dashed", color = "black") +
  geom_hline(yintercept = 10, linetype = "dashed", color = "black") +
  scale_y_continuous(breaks = seq(-100, 120, by = 10))

df4 %>% 
  tidytable::filter(scenario %in% c("N5", "N10", "N15")) %>% 
  ggplot(aes(x = scenario, y = ISS.error*100)) +
  geom_boxplot(aes(fill = type)) +
  labs(x = "Scenario", y = "ISSB % Error") +
  theme_classic() +
  theme(legend.position = c(0.5, 0.2)) +
  geom_hline(yintercept = -10, linetype = "dashed", color = "black") +
  geom_hline(yintercept = 10, linetype = "dashed", color = "black") +
  scale_y_continuous(breaks = seq(-100, 120, by = 10))


# Stats
df4 %>% filter(type=="trip", scenario=="N_0.25") %>% pull(ISS.error) %>% median
df4 %>% filter(type=="trip", scenario=="N_2.00") %>% pull(ISS.error) %>% median
df4 %>% filter(type=="haul", scenario=="N_0.25") %>% pull(ISS.error) %>% median
df4 %>% filter(type=="haul", scenario=="N_2.00") %>% pull(ISS.error) %>% median


```



# Figure 7 Boxplots
Trip and Haul over sample size.
Trip first Haul second.
1999-2023.
Plot A includes scenarios relative to themselves at different sample sizes
Plot B includes scenarios relative to the standard scenario at different sample sizes. 

```{r}
df4.2.a %>% 
  ggplot(aes(x = scenario, y = ISS.error*100)) +
  geom_boxplot(aes(fill = type)) +
  labs(x = "Scenario", y = "ISSB % Error") +
  theme_classic() +
  theme(legend.position = c(0.5, 0.9)) +
  geom_hline(yintercept = -10, linetype = "dashed", color = "black") +
  geom_hline(yintercept = 10, linetype = "dashed", color = "black") +
  scale_y_continuous(breaks = seq(-100, 120, by = 10), limits = c(-100, 120))


df4.global = list(df4.2.a, df4.2.b, df4.1.a, df4.1.b, df4.3.a, df4.3.b)
df4.global[[1]] %>% tidytable::mutate(label1 = "Trip", label2 = "A") %>% 
  tidytable::bind_rows(df4.global[[2]] %>% tidytable::mutate(label1 = "Trip", label2 = "B")) %>% 
  tidytable::bind_rows(df4.global[[3]] %>% tidytable::mutate(label1 = "Haul", label2 = "A")) %>% 
  tidytable::bind_rows(df4.global[[4]] %>% tidytable::mutate(label1 = "Haul", label2 = "B")) %>% 
  tidytable::bind_rows(df4.global[[5]] %>% tidytable::mutate(label1 = "Trip/Haul", label2 = "A")) %>% 
  tidytable::bind_rows(df4.global[[6]] %>% tidytable::mutate(label1 = "Trip/Haul", label2 = "B")) -> df4.global2
 






df4.global2 %>% 
  ggplot(aes(x = scenario, y = ISS.error*100)) +
  geom_boxplot(aes(fill = type)) +
  labs(x = "Scenario", y = "ISSB % Error") +
  theme_classic() +
  # theme(legend.position = c(0.5, 0.9)) +
  geom_hline(yintercept = -10, linetype = "dashed", color = "black") +
  geom_hline(yintercept = 10, linetype = "dashed", color = "black") +
  scale_y_continuous(breaks = seq(-100, 120, by = 10), limits = c(-90, 20)) + 
  facet_grid(label1 ~ label2)





# only 3: relative to standard, get rid of 0.5 trip and haul, and mayhaps some trip/haul combos


df4.global[[1]] %>% tidytable::mutate(label1 = "Trip", label2 = "A") %>% 
  tidytable::bind_rows(df4.global[[3]] %>% tidytable::mutate(label1 = "Haul", label2 = "A")) %>% 
  tidytable::bind_rows(df4.global[[5]] %>% tidytable::mutate(label1 = "Trip/Haul", label2 = "A")) -> df4.global2

df4.global2 %>% 
  ggplot(aes(x = scenario, y = ISS.error*100)) +
  geom_boxplot(aes(fill = type)) +
  labs(x = "Scenario", y = "ISSB % Error") +
  theme_classic() +
  theme(legend.position = c(0.5, 0.9)) +
  geom_hline(yintercept = -10, linetype = "dashed", color = "black") +
  geom_hline(yintercept = 10, linetype = "dashed", color = "black") +
  scale_y_continuous(breaks = seq(-100, 120, by = 10), limits = c(-90, 20)) + 
  facet_grid(rows = vars(label1))
```




## Take Two



```{r, fig.height=12}
p1 = df4.2.a %>% 
  ggplot(aes(x = scenario, y = ISS.error*100)) +
  geom_boxplot(aes(fill = type)) +
  labs(x = "", y = "ISSB % Difference") +
  theme_classic() +
  theme(legend.position = c(0.7, 0.3)) +
  geom_hline(yintercept = -10, linetype = "dashed", color = "black") +
  geom_hline(yintercept = 10, linetype = "dashed", color = "black") +
  scale_y_continuous(breaks = seq(-100, 120, by = 10), limits = c(-90, 20)) +
  guides(fill=guide_legend(title="Trips"))

p2 = df4.1.a %>% 
  ggplot(aes(x = scenario, y = ISS.error*100)) +
  geom_boxplot(aes(fill = type)) +
  labs(x = "", y = "ISSB % Difference") +
  theme_classic() +
  theme(legend.position = c(0.7, 0.3)) +
  geom_hline(yintercept = -10, linetype = "dashed", color = "black") +
  geom_hline(yintercept = 10, linetype = "dashed", color = "black") +
  scale_y_continuous(breaks = seq(-100, 120, by = 10), limits = c(-90, 20)) +
  guides(fill=guide_legend(title="Hauls"))

p3 = df4.3.a %>% 
  ggplot(aes(x = scenario, y = ISS.error*100)) +
  geom_boxplot(aes(fill = type)) +
  labs(x = "Number of Samples", y = "ISSB % Difference") +
  theme_classic() +
  theme(legend.position = c(0.7, 0.3)) +
  geom_hline(yintercept = -10, linetype = "dashed", color = "black") +
  geom_hline(yintercept = 10, linetype = "dashed", color = "black") +
  scale_y_continuous(breaks = seq(-100, 120, by = 10), limits = c(-90, 20)) +
  guides(fill=guide_legend(title="Hauls/Trips"))



p1 + p2 + p3 + plot_layout(ncol = 1)

```


```{r, fig.height=12}
p1 = df4.2.b %>% 
  ggplot(aes(x = scenario, y = ISS.error*100)) +
  geom_boxplot(aes(fill = type)) +
  labs(x = "", y = "ISSB % Difference") +
  theme_classic() +
  theme(legend.position = c(0.7, 0.3)) +
  geom_hline(yintercept = -10, linetype = "dashed", color = "black") +
  geom_hline(yintercept = 10, linetype = "dashed", color = "black") +
  scale_y_continuous(breaks = seq(-100, 120, by = 10), limits = c(-90, 20)) +
  guides(fill=guide_legend(title="Trips"))

p2 = df4.1.b %>% 
  ggplot(aes(x = scenario, y = ISS.error*100)) +
  geom_boxplot(aes(fill = type)) +
  labs(x = "", y = "ISSB % Difference") +
  theme_classic() +
  theme(legend.position = c(0.7, 0.3)) +
  geom_hline(yintercept = -10, linetype = "dashed", color = "black") +
  geom_hline(yintercept = 10, linetype = "dashed", color = "black") +
  scale_y_continuous(breaks = seq(-100, 120, by = 10), limits = c(-90, 20)) +
  guides(fill=guide_legend(title="Hauls"))

p3 = df4.3.b %>% 
  ggplot(aes(x = scenario, y = ISS.error*100)) +
  geom_boxplot(aes(fill = type)) +
  labs(x = "Number of Samples", y = "ISSB % Difference") +
  theme_classic() +
  theme(legend.position = c(0.7, 0.3)) +
  geom_hline(yintercept = -10, linetype = "dashed", color = "black") +
  geom_hline(yintercept = 10, linetype = "dashed", color = "black") +
  scale_y_continuous(breaks = seq(-100, 120, by = 10), limits = c(-90, 20)) +
  guides(fill=guide_legend(title="Hauls/Trips"))



p1 + p2 + p3 + plot_layout(ncol = 1)

```


## * 3 Panel

```{r, fig.height=12, fig.width=10}
p1 = df4.2.b %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 2, end = -1)) %>%
  tidytable::mutate(scenario = forcats::fct_inorder(scenario)) %>% 
  ggplot(aes(x = scenario, y = ISS.error*100)) +
  geom_boxplot(aes(fill = type)) +
  labs(x = "", y = "ISSB % Difference", tag = "A") +
  theme_classic() +
  theme(legend.position = c(0.7, 0.15), 
        legend.direction = "horizontal", 
        legend.box = "horizontal",
        plot.tag.position = c(0.1, 0.95),
        plot.tag = element_text(size = 14, face = "bold")) + 
  guides(fill = guide_legend(title = "Trips",
                             title.position = "top", 
                             title.hjust = 0.5,
                             label.position = "bottom"))  +
  geom_hline(yintercept = -10, linetype = "dashed", color = "black") +
  geom_hline(yintercept = 10, linetype = "dashed", color = "black") +
  scale_y_continuous(breaks = seq(-100, 120, by = 10), limits = c(-90, 30))

p2 = df4.1.b %>% 
  tidytable::mutate(scenario = str_sub(scenario, start = 2, end = -1)) %>% 
  tidytable::mutate(scenario = forcats::fct_inorder(scenario)) %>% 
  ggplot(aes(x = scenario, y = ISS.error*100)) +
  geom_boxplot(aes(fill = type)) +
  labs(x = "", y = "ISSB % Difference", tag = "B") +
  theme_classic() +
  theme(legend.position = c(0.7, 0.15), 
        legend.direction = "horizontal", 
        legend.box = "horizontal",
        plot.tag.position = c(0.1, 0.95),
        plot.tag = element_text(size = 14, face = "bold")) + 
  guides(fill = guide_legend(title = "Hauls",
                             title.position = "top", 
                             title.hjust = 0.5,
                             label.position = "bottom"))  +
  geom_hline(yintercept = -10, linetype = "dashed", color = "black") +
  geom_hline(yintercept = 10, linetype = "dashed", color = "black") +
  scale_y_continuous(breaks = seq(-100, 120, by = 10), limits = c(-90, 30))

p3 = df4.3.b %>% 
  tidytable::mutate(scenario = factor(str_sub(scenario, start = 2, end = -1))) %>% 
  tidytable::filter(type %in% scenario_names.short[c(2,4,5,6,7)]) %>%
  tidytable::mutate(scenario = forcats::fct_inorder(scenario)) %>% 
  ggplot(aes(x = scenario, y = ISS.error*100)) +
  geom_boxplot(aes(fill = type)) +
  labs(x = "Samples per Haul", y = "ISSB % Difference", tag = "C") +
  theme_classic() +
  theme(legend.position = c(0.7, 0.15), 
        legend.direction = "horizontal", 
        legend.box = "horizontal",
        plot.tag.position = c(0.1, 0.95),
        plot.tag = element_text(size = 14, face = "bold")) + 
  guides(fill = guide_legend(title = "Hauls/Trips",
                             title.position = "top", 
                             title.hjust = 0.5,
                             label.position = "bottom"))  +
  geom_hline(yintercept = -10, linetype = "dashed", color = "black") +
  geom_hline(yintercept = 10, linetype = "dashed", color = "black") +
  scale_y_continuous(breaks = seq(-100, 120, by = 10), limits = c(-90, 30))



p1 + plot_spacer() + p2 + plot_spacer() + p3 + plot_layout(ncol = 1,
                           heights = c(6, -.5, 6, -.5, 6))

```






## Plot 3.1

3x3 grid.

### Data
```{r}
out_2.1.1 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_2.1.1_ISS_200_iters_2024-11-27.RDS")

out_2.2.1 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_2.2.1_ISS_200_iters_2024-12-02.RDS")





year = out_2.1.1$samples_10$expansion_NULL$length$iss$YEAR

samples_global = c(10, 20, 30)
expansion_global = list(NULL, "haul_numbers", c("haul_numbers", "month_numbers"))
expansion_names_global = c("NULL", "haul_numbers", c("haul_month_numbers"))

```









### * With sampling strata
```{r, fig.width=9, fig.height=5}
df = tidytable(year = year,
               N10_Enone = out_2.1.1$samples_10$expansion_NULL$length$iss$iss,
               N20_Enone = out_2.1.1$samples_20$expansion_NULL$length$iss$iss,
               N30_Enone = out_2.1.1$samples_30$expansion_NULL$length$iss$iss,
               N10_Emedium = out_2.1.1$samples_10$expansion_haul_numbers$length$iss$iss,
               N20_Emedium = out_2.1.1$samples_20$expansion_haul_numbers$length$iss$iss,
               N30_Emedium = out_2.1.1$samples_30$expansion_haul_numbers$length$iss$iss,
               N10_Efull = out_2.1.1$samples_10$expansion_haul_month_numbers$length$iss$iss,
               N20_Efull = out_2.1.1$samples_20$expansion_haul_month_numbers$length$iss$iss,
               N30_Efull = out_2.1.1$samples_30$expansion_haul_month_numbers$length$iss$iss,) 

df2 = melt.data.table(df, id.vars = "year", variable.name = "scenario", value.name = "ISS")



ggplot(data = df2, aes(x = year, y = ISS, group = scenario, colour = scenario)) +
  geom_line() +
  labs(x = "", y = "ISSB") +
  geom_point() + 
  theme_classic() +
  theme(legend.position = c(0.84, 0.8),
        axis.title.x = element_blank())
```


```{r, fig.width=9, fig.height=5}
# stats
((df$N10_Enone - df$N20_Enone)/df$N20_Enone) %>%
  mean()

((df$N10_Emedium - df$N20_Emedium)/df$N20_Emedium) %>%
  mean()

((df$N10_Efull - df$N20_Efull)/df$N20_Efull) %>%
  mean()
(-.02 - .12 - .08)/3


((df$N30_Enone - df$N20_Enone)/df$N20_Enone) %>%
  mean()

((df$N30_Emedium - df$N20_Emedium)/df$N20_Emedium) %>%
  mean()

((df$N30_Efull - df$N20_Efull)/df$N20_Efull) %>%
  mean()

(.03 + .04 +.03)/3


```


### Without sampling strata
```{r}

df = tidytable(year = year,
               N10_Enone = out_2.2.1$samples_10$expansion_NULL$length$iss$iss,
               N20_Enone = out_2.2.1$samples_20$expansion_NULL$length$iss$iss,
               N30_Enone = out_2.2.1$samples_30$expansion_NULL$length$iss$iss,
               N10_Emedium = out_2.2.1$samples_10$expansion_haul_numbers$length$iss$iss,
               N20_Emedium = out_2.2.1$samples_20$expansion_haul_numbers$length$iss$iss,
               N30_Emedium = out_2.2.1$samples_30$expansion_haul_numbers$length$iss$iss,
               N10_Efull = out_2.2.1$samples_10$expansion_haul_month_numbers$length$iss$iss,
               N20_Efull = out_2.2.1$samples_20$expansion_haul_month_numbers$length$iss$iss,
               N30_Efull = out_2.2.1$samples_30$expansion_haul_month_numbers$length$iss$iss,) 

df2 = melt.data.table(df, id.vars = "year", variable.name = "scenario", value.name = "ISS")



ggplot(data = df2, aes(x = year, y = ISS, group = scenario, colour = scenario)) +
  geom_line() +
  labs(x = "Year", y = "ISS") +
  geom_point()



```





## Plot 4.1 Trip and Haul x .5, 1.5

2x3 grid.


### Data
```{r}
out_19.1 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_19.1_ISS_200_iters_2024-12-18.RDS")

out_20.1 = readRDS(file = "C:/Users/bstacy2/OneDrive - UW/UW Postdoc/GitHub Repos/baseISS_data/outputs/paper_output/paper_scenario_20.1_ISS_200_iters_2024-12-19.RDS")





year = out_19.1$proportion_0.5$expansion_NULL$length$iss$YEAR

```


### Trip

```{r, fig.width=9, fig.height=5}
df = tidytable(year = year,
               N0.5_Enone = out_19.1$proportion_0.5$expansion_NULL$length$iss$iss,
               N1.0_Enone = out_19.1$proportion_1$expansion_NULL$length$iss$iss,
               N1.5_Enone = out_19.1$proportion_1.5$expansion_NULL$length$iss$iss,
               N0.5_Emedium = out_19.1$proportion_0.5$expansion_haul_numbers$length$iss$iss,
               N1.0_Emedium = out_19.1$proportion_1$expansion_haul_numbers$length$iss$iss,
               N1.5_Emedium = out_19.1$proportion_1.5$expansion_haul_numbers$length$iss$iss,
               N0.5_Efull = out_19.1$proportion_0.5$expansion_haul_month_numbers$length$iss$iss,
               N1.0_Efull = out_19.1$proportion_1$expansion_haul_month_numbers$length$iss$iss,
               N1.5_Efull = out_19.1$proportion_1.5$expansion_haul_month_numbers$length$iss$iss,) 

df2 = melt.data.table(df, id.vars = "year", variable.name = "scenario", value.name = "ISS")



ggplot(data = df2, aes(x = year, y = ISS, group = scenario, colour = scenario)) +
  geom_line() +
  labs(x = "", y = "ISSB") +
  geom_point() + 
  theme_classic() +
  theme(legend.position = c(0.84, 0.8),
        axis.title.x = element_blank())
```





### Haul

```{r, fig.width=9, fig.height=5}
df = tidytable(year = year,
               N0.5_Enone = out_20.1$proportion_0.5$expansion_NULL$length$iss$iss,
               N1.0_Enone = out_20.1$proportion_1$expansion_NULL$length$iss$iss,
               N1.5_Enone = out_20.1$proportion_1.5$expansion_NULL$length$iss$iss,
               N0.5_Emedium = out_20.1$proportion_0.5$expansion_haul_numbers$length$iss$iss,
               N1.0_Emedium = out_20.1$proportion_1$expansion_haul_numbers$length$iss$iss,
               N1.5_Emedium = out_20.1$proportion_1.5$expansion_haul_numbers$length$iss$iss,
               N0.5_Efull = out_20.1$proportion_0.5$expansion_haul_month_numbers$length$iss$iss,
               N1.0_Efull = out_20.1$proportion_1$expansion_haul_month_numbers$length$iss$iss,
               N1.5_Efull = out_20.1$proportion_1.5$expansion_haul_month_numbers$length$iss$iss,) 

df2 = melt.data.table(df, id.vars = "year", variable.name = "scenario", value.name = "ISS")



ggplot(data = df2, aes(x = year, y = ISS, group = scenario, colour = scenario)) +
  geom_line() +
  labs(x = "", y = "ISSB") +
  geom_point() + 
  theme_classic() +
  theme(legend.position = c(0.84, 0.8),
        axis.title.x = element_blank())
```











## Correlation Plots

Can I calculate the intra-haul correlation between samples and plot that against sample size for average over the sampling years?

I would have to sample with replacement lengths at every sample size and save them then corr() them, or save the corr() for every iteration, or save the average corr() over all iterations - then I could average over years to come up with either a boxplot or line plot. 

```{r}

```









